Description of the IPM-DAT file format and example of the input IPM-DAT file

# GEMIPM2K v. 0.98
# Prototype 12.12.2006
# Comment lines are marked with '#' and will be ignored when reading the file

# ipm-dat text input file for GEM-IPM specific data generated by the 
# GEMS-PSI GEM2MT module 
# This file should be be read after the DATACH file and before the DATABR file

# The IPM-DAT file is complementary to the DATACH file. 
# The IPM-DAT file contains parts of chemical system definitions (CSD) that are 
# used by GEM IPM part but not visible to the FMT part of the coupled code. 
# Contents of this file will be placed in the MULTI internal work structure 
# of GEM IPM, not visible outside of it. 

# The IPM-DAT text input file consists of six sections, of which 
# sections (1) and (2) contains flags and dimensionalities for additional
# memory allocation for surface complexes (main dimensionalities of the 
# chemical system are given in DATACH file);
# section (3) contains numerical controls of GEM IPM algorithm operation
# and convergence;  
# section (4) defines the presence and data for mixing models of multi-
# component phases and, if necessary, the arrays of non-ideality parameters; 
# sections (5) and (6) provide some complete data arrays that may be 
# incomplete in DATABR file(s); 
# section (7) contains some initial data for phases; and, finally, 
# section (8) contains initial data for sorption (surface complexation) 
# phases, present if set in section (2). 

# The IPM-DAT file consists of one or more input data objects (fields) and 
# comment lines. A comment line begins with the '#' character in the first 
# position; by reading the file, anything after '#' will be ignored until the 
# line end code(s). Any data object field begins with a tag - an identifier 
# in angle brackets <>; the tag is followed by one or more values, depending 
# on the type and dimensions of the data objects. The data objects which define 
# dimensionalities of other data objects must always be provided in the beginning
# of the file, before the reserved tag <END_DIM>. Other data object items may 
# follow in any order (although it is recommended to keep them in logical 
# sections as seen after printing the file from the GEMS code). Some data objects
# can be skipped (the tag together with all values; part of values cannot be 
# skipped).
#   
# Many data object fields after the <END_DIM> tag are not obligatory; 
# when skipped, the default values will be used in the program memory. 
# However, if some optional dimensions are set (e.g. <Lads>) before the 
# <END_DIM> tag then the data objects connected to it must also be provided 
# in rest of the file. 

# The actual numbers in this description are related to a particular example 
# of the chemical system and are given for illustration purposes. 
# The numbers and name lists may change if a different CSD is constructed. 

# ID key of the initial chemical system definition 
"CalDolCol G  CalcColumn  1001 0       1       25      000 "

## (Section 1) Important flags that affect memory allocation
# Flag for using electroneutrality condition in GEM IPM calculations 
# (should be set to 1 if IC "charge" "Zz" is present in the system 
# definition; may be automatically switched off to 0 if e.g. aqueous 
# phase has been eliminated)
<pa_PE>            1

# Flag for the volume balance constraint (on Vol IC) - for indifferent
# equilibria at P_Sat (not used in this version). If PV = 1 then the 
# Independent Component "Vol" must be included for volume balance. The 
# normal value of PV is 0.
<PV>               0

# Total number of DCs in liquid hydrocarbon phases (for the old FGL module, 
# will soon be obsolete).
<PSOL>             0

# The following two flags must be set on (+) if sorption phases are 
# present in the system definition
# Flag for using (+) or ignoring (-) specific surface areas of phases 
<PAalp>          '+'

# Flag for using (+) or ignoring (-) specific surface free energies of 
# phase-aqueous and phase-gas interfaces 
<PSigm>          '+'

## Section (2) Important additional dimensionalities that affect memory 
# allocation in the MULTI data structure of IPM
# Total number of Dependent Components in sorption phases included into
# this system. If Lads > 0 and FIa > 0 then the data section (7) must 
# be provided at the end of this file (see also "scm-ipm-dat-doc.txt" file)
<Lads>             0
# Number of sorption phases included in this system (0 if no sorption 
# phases are included).
<FIa>              0
# Actual maximum number of surface types per adsorption phase (if FIa > 0,
# <FIat> must be set to 6). 
<FIat>             0

<END_DIM>

## Section (3): Controls of operation of the GEM IPM numerical algorithm
# These settings should be changed carefully, only if you know what you 
# are doing. Wrong control values and flags may strongly hinder convergence, 
# accuracy and performance of GEM IPM, or cause it to crash or produce 
# meaningless results.
#
# Minimum amount of Independent Component in bulk composition (except 
# charge "Zz"), moles (may be set in the interval 1e-17 < DB < 1e-7)
<pa_DB>        1e-17

# Maximum allowed mass balance residual (moles) for major Independent 
# Components (may be set in the interval 1e-10 < DHB < 1e-6)
<pa_DHB>       1e-08
# Precision criterion of the simplex() procedure to obtain the automatic 
# initial approximation (may be set in the interval 1e-10 < DHB < 1e-6)
<pa_EPS>       1e-07  

# IPM convergence threshold for the Dikin criterion (may be set in the 
# interval 1e-6 < DK < 1e-4, value 1e-4 is recommended). Setting too low 
# DK < 1e-5 may dramatically increase the number of IPM iterations, slow
# the convergence down, and deteriorate the quality and mass balance 
# precision of the GEM IPM result.  
<pa_DK>       0.0001

# Threshold for the application of the Karpov phase stability criterion 
# f_a (a diagnostic criterion for determining which phases are stable
# (|f_a| <= DF) and which are not (|f_a| > DF). Changing this value is 
# not recommended.
<pa_DF>         0.01

# Maximum allowed number of iterations in the EnterFeasibleDomain() 
# procedure (can be set between 10 and 200).
<pa_DP>          144

# Maximum allowed number of iterations in the MainIPM_Descent() procedure.
# Usual number after simplex initial approximation is between 20 and 100, 
# after reading the previous GEM solution as initial approximation - ca. 
# 10 to 20 times less. In highly non-ideal systems with many solid solutions, 
# more than 300 iterations may be required. 
<pa_IIM>         500

# Control on calling built-in Debye-Hueckel() and other models for aqueous 
# activity coefficients (internal control, do not change).
<pa_PD>            3

# Positive number: control of calling IPM_gamma() on IPM iterations 
# (default 3 - on every IPM iteration). 
# Negative number (from -1 to -20): the number |PRD| of additional full 
# IPM loops to improve the GEM final solution in highly non-ideal systems 
# (especially around the critial point). IPM_gamma() is called on each 
# GEM iteration, as usual. 
<pa_PRD>          -1

# Smoothing parameters controlling IPM convergence in highly non-ideal 
# systems. AG can be set between 0.7 and 1.0; DGC between 0.01 and 0.1. 
# If there is no non-ideal solutions in the system then it is best to 
# set AG = 1. 
<pa_AG>            1
<pa_DGC>        0.07

# Flag for using initial activity coefficients <lnGmf> for simplex() 
# initial approximation (1-enable, 0-disable)
<pa_PSM>           1

# Initial activity coefficient values for simplex() initial approximation:
# GAR for major components (default 1) and GAH for minor components 
# (default 1000). 
<pa_GAR>           1
<pa_GAH>        1000

# Cutoff threshold for the elimination of a phase if its amount goes 
# below this threshold. Values can be set between 1e-7 and 1e-12 mol.
<pa_DS>        1e-09

# Cutoffs for elimination of: Xw water solvent; Sc - solid sorbent; 
# Dc - solution or surface species; Ph - non-electrolyte solution phases
<pa_XwMin>     1e-09
<pa_ScMin>     1e-07
<pa_DcMin>     1e-20
<pa_PhMin>     1e-10

# Minimal ionic strength below which the activity coefficients 
# for aqueous species are set to 1
<pa_ICmin>     3e-05

# Mode of Selekt2() procedure operation (do not change):
<pa_PC>            1

# Threshold of Karpov stability criterion f_a for insertion of a phase 
# in Selekt2() procedure 
<pa_DFM>        0.1

# Insertion amounts used after the simplex() initial approximation and 
# in the Selekt2() procedure for zeroes-off species 
# (usually no need to change):
# DFYw - water solvent;
<pa_DFYw>      1e-06
# DFYaq - aqueous species;
<pa_DFYaq>     1e-06
# DFYid - ideal solution components;
<pa_DFYid>     1e-06
# DFYr - major solution components;
<pa_DFYr>      1e-06
# DFYh - minor solution components;
<pa_DFYh>      1e-06
# DFYc - single-component phase; 
<pa_DFYc>      1e-06
# Insertion amount of single-component phase in Selekt2() algorithm only
<pa_DFYs>      1e-06

# Parameters for high-accuracy IPM-2 algorithm 
# Number of the IPM-2 enhancement loops for obtaining high-accuracy 
# improved mass balance (from 0 to 15)
<pa_DW>            0
# Exponent for dual-thermodynamic restoring of low amounts of 
# solutes (+2 to -5), relative to DHBM (default 0 or -2 for sorption
# models)
<pa_DT>            0
# IPM2 balance accuracy control ratio DHBM[i]/b[i], determines the 
# maximum allowed mass balance error for minor Independent Components
# (value of 0.001 means 1% residual relative to IC amount in the system). 
<pa_GAS>       0.001

# Parameters for surface complexation models
# Standard surface density (nm-2) for calculating activity of 
# surface species (do not change unless a different standard value is
# used in the supplied thermodynamic database)
<pa_DNS>       12.05
# Control parameter of SACT calculation in sorption/surface 
# complexation models (can be set between 0.01 and 0.000001).
<pa_IEPS>      0.001

# Flag for using metastability/kinetic constraints on calculated 
# DC amounts (see <DLL>, <DUL> arrays)
<pKin>             1
# Tolerance on the amount of DC with two-side metastability constraints 
# set equal in <DLL>, <DUL> (moles) 
<pa_DKIN>     0.0001


## (Section 4) Initial data for multicomponent phases (see DATACH file for 
# the dimension <nPS>) and mixing model parameters. 
# Codes for mixing models of multicomponent phases: six characters per
# phase, only built-in mixing models are allowed (no phase scripts). 
# Of these six characters, the second, third and fifth must be set to
# 'N'. The fourth character can be either 'I' (ideal mixing) or 'S' 
# (the built-in subroutine will be used for the non-ideal model). The 
# sixth character is either 'N' or the code of most complex EDL model 
# used in sorption phases. 
# The first character can be 'I' (ideal solution) or another character 
# which defines the built-in subroutine for calculation of activity 
# coefficients on GEM IPM iterations to be used for this phase).
# Some possible built-in subroutine codes:  
# 'G' - binary Guggenheim (Redlich-Kister) subregular solid solution; 
#    requires <LsMod>[k] = 3 and 3 parameters (a0, a1, a2) to be provided 
#    in the <PMc> array for this phase;
# 'M' - binary Margules subregular solid solution with T,P dependent 
#    parameters; requires <LsMod>[k] = 6 and 3 parameters (Wu, Ws, Wv) 
#    per end-member to be provided in the <PMc> array for this phase;
# 'T' - ternary Margules regular solid solution with T,P dependent 
#    parameters; requires <LsMod>[k] = 12 and 4 x 3 parameters (Wu, Ws, Wv) 
#    to be provided in the <PMc> array for this phase;
# 'H' - Extended Debye-Hueckel equation for aqueous species with common 
#    ion-size parameter a0 (Angstrom) and common b_gamma parameter; 
#    requires <LsMod>[0] = 8; the parameters are given in <PMc>[5] (a0) 
#    and <PMc>[6] (b_gamma), respectively (<PMc> indexation starts 
#    from [0]);
# '3' - Extended Debye-Hueckel equation for aqueous species with individual  
#    (Kielland) ion-size parameter a0 (Angstrom), taken from <DMc> vector
#    (<LsMdc>[0] = 1), and common b_gamma parameter given in <PMc>[6] (<PMc> 
#    indexation starts from [0], requires <LsMod>[0] = 8);
# '2' - Debye-Hueckel equation for aqueous species with individual  
#    (Kielland) ion-size parameter a0 (Angstrom), taken from <DMc> vector
#    (requires <LsMdc>[0] = 1 and <LsMod>[0] = 0);
# '1' - Debye-Hueckel limiting law for aqueous species, without the ion-size 
#    parameter (<LsMdc>[0] = 0 and <LsMod>[0] = 0);
# 'D' - Davies equation for aqueous species (requires <LsMdc>[0] = 0 
#    and <LsMod>[0] = 0);
# 'A' - built-in SACT and EDL calculations in CD-MUSIC or NEM surface 
#    complexation model (for sorption phases only, <LsMdc>[0] = 0 
#    and <LsMod>[0] = 0);
<sMod>
'DNNSNN' 'INNINN' 

# Dimensions for parameters of non-ideal mixing models per whole  
# multicomponent phase; depends on the code in <sMod>. 
# If elements in at least one row of <LsMod> are not zero then 
# the <IPxPH> and <PMc> arrays must be provided hereafter.
<LsMod>
0 0 0 
0 0 0  

# IPxPH: List of indexes of interaction parameters for non-ideal solutions 
# Number of parameters used by k-th phase model is given in <LsMod>[k][0] 
# and their maximum order (number of columns in IPxPH) is given in 
# <LsMod>[k][1]. Uncomment this and provide indexes of interaction 
# parameters if at least one row in <LsMod> is not zeros 
# (under construction).  
# <IPxPH>

# Parameters per phase for the non-ideal mixing models. Number of 
# parameters used by k-th phase model is given in <LsMod>[k][0] and 
# the number of coefficients per parameter - in <LsMod>[k][2]. 
# Uncomment the tag below and provide necessary numbers if at 
# least one row in <LsMod> is not zeros. 
# <PMc> 
# parameter1, parameter2, ...

# Number of parameters per component of the phase for the non-ideal 
# mixing models; depends on the code in <sMod>. If at least one 
# element in <LsMdc> is not zero then the <DMc> vector must be provided 
# after this or the <PMc> item.
<LsMdc>
0 
0 

# Parameters per phase component for the non-ideal mixing models. 
# Number of parameters per component used by k-th phase model is 
# given in <LsMdc>[k]. Uncomment the tag below and provide necessary 
# numbers if at least one element in <LsMdc> is not zero. Total 
# number of parameters per phase in <DMc> is <LsMdc>[k] times the 
# number of Dependent Components included in the phase. 
# <DMc> 
# parameter1, parameter2, ...

## Section (5): Some data arrays which are not provided in DATACH 
# file or may be provided incomplete in DATABR files when not all 
# ICs, DCs or phases were selected to be kept there (if so then 
# amounts of unselected ICs given here will remain constant 
# in all nodes and times).
#
# Full total bulk composition of the initial system (vector b)
# (see DATACH file for dimension <nIC> and list of ICs <ICNL>)
<B>
3.31e-04 3.31e-04 2.0e-07 1.106837e+02 1.0e-07 5.534286e+01 0.0e+00 

# Initial data for DCs - see DATACH file for dimensions <nDC>, 
# <nDCs> and the list of DC names <DCNL>

# Partial pressures (or fugacities) of Dependent Components 
# (for setting constant chemical potentials or pure gas fugacity)
# Default values: total pressure P (bar). Size: <nDC>
<Pparc>
1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 
1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 
1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 
1.0e+00 1.0e+00 1.0e+00 1.0e+00 

# Increments for adjustment of G0 values of Dependent Components 
# in J/mol/(RT) (normalized units) (default value: 0). Size: <nDC>
<GEX>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Natural logarithms of activity coefficients to be used at 
# simplex() initial approximation in GEM IPM (default 0 for 
# all components except minor 'J' end members and surface 
# complexes for which the default is ln(1000) = 6.907755375).
# Size: <nDC>.
<lnGmf>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# (Section 6) Section for metastability/ kinetic constraints on amounts 
# of Dependent Components (<xDC>) in GEM IPM result. 
# Code of metastability/kinetic constraints for DCs
# 'B' - both sides (DLL and DUL are used); 'L' - from below only
# (DUL is trivial 1e6 mol); 'U' - from above only (DLL is trivial 
# 0 mol). Size: <nDC>
<RLC>
'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 
'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 
'B' 'B' 'B' 'B' 'B' 'B' 'B' 'B' 

# Units of metastability/kinetic constraints for DCs 
# (see vectors DUL, DLL). By now, only 'M' (moles) code 
# can be accepted. Size: <nDC>.
<RSC>
'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 
'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 
'M' 'M' 'M' 'M' 'M' 'M' 'M' 'M' 

# Full vector of lower metastability constraints on DC
# amounts <xDC> in the system. Entered here because this 
# data may be provided incomplete in DATABR file(s) if not
# all DCs were selected to be kept there. Size: <nDC>.
# Default value: 0 mol.
<DLL>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Full vector of upper metastability constraints on DC
# amounts <xDC> in the system. Entered here because this 
# data may be provided incomplete in DATABR file(s) if not
# all DCs were selected to be kept there. Size: <nDC>
# Default value: 1e6 mol.
<DUL>
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 
1.0e+06 1.0e+06 1.0e+06 1.0e+06 

# Section (7): Initial data for phases
# Full vector of specific surface areas of phases
# Default value: 0 m2/g Part or all values may be set up in 
# the DATABR file(s). Size: <nPH> (see DATACH file).
<Aalp>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Specific surface free energy for phase-water interface (J/m2)
# Cannot be set in DATABR or DATACH files - only here
# Size: <nPH>. Default - 0 J/m2
<Sigw>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Specific surface free energy for phase-gas interface
# (not yet used). Default: 0 J/m2. Size: <nPH>.
<Sigg>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Surface free energy or metastability parameters for phases
# (in J/g to accomodate for variable phase composition). 
# Default: 0 J/g. Size: <nPH>
<YOF>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Section (8): Setup of surface complexation models. Should 
# be provided only if sorption phase(s) are included in the 
# system definition (<FIa> > 0 and <Lads> > 0 and <FIat> > 0). 
# In this data example, sorption is not included. See another
# example in "scm-ipm-dat-doc.txt" file. 
# <Nfsp>
# <MASDT>
# <C1>
# <C2>
# <C3>
# <pCh>
# <SATX>
# <MASDJ>
# <SCM>
# <SACT>
# <DCads>

# End of file
