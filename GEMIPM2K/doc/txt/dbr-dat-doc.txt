# Description of the DATABR file format and example of the input DATABR file

# GEMIPM2K v. 0.780
# Prototype 28.07.2006
# Comment lines are marked with '#' and will be ignored when reading the file

# dbr-dat text input file for DATABR data generated by the GEMS-PSI GEM2MT module 
# This file should be be read after the DATACH and the IPM-DAT files

# This file (read into the DATABR memory structure) describes properties 
# of the local-equilibrium node that should be exchanged between the coupled 
# FMT and GEM parts. Hence, the DATABR data structure is the main interface
# for coupling mass transport and chemistry (see DATABR.H file).
# The DATABR file and structure contain parts of the chemical system definition 
# that may be changed by the FMT part (input data of GEM such as T, P, 
# bulk composition, metastability constraints) or are returned after 
# the GEM IPM calculation and can be utilized by the FMT part in 
# the next time iteration loop.

# The DATABR text input file consists of several sections. 
# Dimesions of all arrays in DATABR correspond to Section 2
# and the order of components and phases - to the index lists 
# in Section (4) in the DATACH file (see dch-dat-doc.txt file). 
# Here, we will refer to tags from these two sections even though
# these tags are not present in the DATABR file; it is assumed 
# that the DATACH structure exists and is correctly filled out 
# before any operation with DATABR files or structures. 

# At present, data tags and fields in this file have a fixed order, but 
# this may be changed to the arbitrary order in the following versions. 

# The actual numbers in this description are related to a particular 
# example of # the chemical system (the same as in the dch-dat-doc.txt 
# and ipm-dat-doc.txt files) and are given for illustration purposes. 
# The numbers and name lists may change if a different CSD is constructed. 

# Section (Scalar-1): controls of the GEM IPM operation and data exchange
# Node identification handle - in Tnodearray, the current node
# index should be assigned here (used in diagnostic messages and 
# output files).
<NodeHandle>     0
# Node type (hydraulic); see typedef NODETYPE in the DATABR.H
<NodeTypeHY>     0
# Node type (mass transport); see typedef NODETYPE in the DATABR.H
<NodeTypeMT>     0
# Node status code FMT; see typedef NODECODEFMT in the DATABR.H
<NodeStatusFMT>  1
# Node status code GEM (output); see typedef NODECODECH in the DATABR.H
<NodeStatusCH>   1
# Number of iterations performed by GEM IPM (output)
<IterDone>       34

## Section (Scalar-2): Chemical scalar variables
# Node Temperature T, K (GEM input)
<T>    298.15
# Node Pressure P, bar (GEM input)
<P>    1
# Volume V of reactive subsystem in the node, m3 (GEM output)
<Vs>   9.99944e-4
# Volume of inert subsystem, m3 (used only in FMT part)
<Vi>   0
# Mass of reactive subsystem, kg (GEM output) 
<Ms>   0.997033
# Mass of inert subsystem, kg (used only in FMT part)
<Mi>   0
# Gibbs energy of reactive subsystem, J/RT (normalized), GEM output
<Gs>   -5295.11
# Enthalpy of reactive subsystem, J (reserved)
<Hs>   0
# Enthalpy of inert subsystem, J (used only in FMT part) 
<Hi>   0
# Effective aqueous ionic strength, molal (GEM output)
<IS>   0.000385368
# pH of aqueous solution (GEM output)
<pH>   9.90998
# pe of aqueous solution (GEM output) 
<pe>   10.3367
# Eh of aqueous solution, V (GEM output)
<Eh>   1

## Section (Scalar-3): FMT scalar variables (not used on the level of TNode)
# actual total simulation time, s
<Tm>   0
# actual time step, s
<dt>   0
# General diffusivity of disolved matter in the node, m2/s 
<Dif>  0
# total volume of the node (voxel), m3
<Vt>   0
# advection velocity (in pores) in this node, m/s
<vp>   0
#  effective (actual) porosity normalized to 1
<eps>  0
# actual permeability, m2 
<Km>   0
# actual DARCY`s constant, m2/s
<Kf>   0
# specific storage coefficient, dimensionless 
<S>    0
# transmissivity, m2/s
<Tr>   0
# actual hydraulic head (hydraulic potential), m
<h>    0
# actual carrier density for density-driven flow, kg/m3
<rho>  0
# specific longitudinal dispersivity of porous media, m
<al>   0
# specific transversal dispersivity of porous media, m
<at>   0
# specific vertical dispersivity of porous media, m
<av>   0
# hydraulic longitudinal dispersivity, m2/s
<hDl>  0
# hydraulic transversal dispersivity, m2/s
<hDt>  0
# hydraulic vertical dispersivity, m2/s
<hDv>  0
# tortuosity factor
<nto>  0

### Arrays:
## Section (IC data):
# Bulk composition of (reactive part of) the system - GEM input (moles)
# Number of elements: <nICb>; order of IC: defined in <xIC> index list
# in the DATACH file/structure. Numbers in <bIC> must be positive, 
# between 1e-16 and 9.9999e+5 mol, except the last number (charge balance)
# which is usually set to zero. 
# This vector is the main input of GEM IPM. Inconsistent data in <bIC> 
# may cause bad convergence or failure of the GEM IPM algorithm. 
<bIC>
3.31e-04 3.31e-04 2.0e-07 1.106837e+02 1.0e-07 5.534286e+01 0.0e+00 

# Mass balance residuals - GEM output (moles)
# Number of elements: <nICb>; order of IC: defined in <xIC> index list
# in the DATACH file/structure.
# Good mass balance residuals must be less than 1e-7 or 0.1% of the 
# respective element of the total bulk composition <bIC> which is less 
# than 1e-7. This vector can be checked for evaluating quality of the
# GEM IPM solution.
<rMB>
2.77121e-10 -1.28589e-10 -2.50312e-10 -8.197958e-10 5.59653e-10 
-7.62758e-10 -4.17019e-10 

# Chemical potentials of ICs (dual GEM solution) - GEM output, normalized
# Number of elements: <nICb>; order of IC: defined in <xIC> index list
# in the DATACH file/structure.
# This vector contains normalized chemical potentials of Independent 
# Components, from which and the stoichiometry, the chemical potential
# of any DC in this system can be algebraically calculated. 
# Usage of dual GEM solution may lead to innovative and powerful new 
# coupling between FMT algorithms and chemistry. 
<uIC>
-1.684504e+02 -2.797380e+02 -4.4603514e+01 -4.661977e+01 -2.470017e+02 
-2.437813e+00 2.380119e+01 

## Section (DC data):
# Speciation - amounts of DCs in equilibrium state -primal GEM solution 
# (GEM output), moles
# Number of elements: <nDCb>; order of DC: defined in <xDC> index list
# in the DATACH file/structure.
# This is the usual result of equilibrium speciation calculations, from
# which concentrations of all species (or activities using the <gam> 
# output vector) can be computed. Zeros correspond to species eliminated
# from the equilibrium state (i.e. unstable species). 
# This vector (together with <gam>) is used by GEM IPM as initial 
# approximation in the respective calculation mode (which can dramatically
# reduce computation time)
<xDC>
5.528197e-06 1.129165e-07 1.166220e-04 1.468978e-07 2.543960e-09 
8.225826e-11 9.420985e-08 2.604276e-09 2.249056e-08 3.380003e-05 
8.294333e-05 0.0e+00 0.0e+00 2.002503e-07 0.0e+00 1.000084e-05 
8.295096e-05 1.255582e-10 5.53417651e+01 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 2.085901e-04 0.0e+00 0.0e+00 0.0e+00 

# Activity coefficients of DCs in their respective phases - GEM output
# Number of elements: <nDCb>; order of DC: defined in <xDC> index list
# in the DATACH file/structure.
# Activity coefficients multiplied by concentrations of species in 
# their respective phase yield activities of those species. 
# This vector (together with <xDC>) is used by GEM IPM as initial 
# approximation in the respective calculation mode (which can dramatically
# reduce computation time)
<gam>
1.0e+00 9.777179e-01 9.138066e-01 9.777179e-01 1.0e+00 9.777179e-01 
9.138066e-01 9.777179e-01 1.0e+00 9.138066e-01 9.777179e-01 1.0e+00 
9.777179e-01 9.777179e-01 1.0e+00 1.0e+00 9.777179e-01 9.777179e-01 
1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 1.0e+00 
1.0e+00 1.0e+00 

# Lower metastability constraints on amounts of DCs - GEM input, moles
# Number of elements: <nDCb>; order of DC: defined in <xDC> index list
# in the DATACH file/structure.
# Trivial (default) value: 0.0 mol
# This input allows to simulate various kinetic controls, e.g. dissolution
# kinetics, as function of time and solution composition.
# Great care should be taken to ensure consistent values of these 
# constraints; inconsistent (too large) values may cause the program
# crash or the GEM IPM algorithm failure. 
<dll>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 
0.0e+00 

# Upper metastability constraints on amounts of DCs - GEM input, moles
# Number of elements: <nDCb>; order of DC: defined in <xDC> index list
# in the DATACH file/structure.
# Trivial (default) value: 1e6 mol.
# This input allows to simulate various kinetics, e.g. precipitation
# kinetics
<dul>
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 
1.0e+06 

## Section (Phase data):
# Specific surface areas of phases (m2/g) - GEM input
# Number of elements: <nPHb>; order of phases: defined in <xPH> index 
# list in the DATACH file/structure.
<aPH>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Amounts of phases in equilibrium state - GEM output (moles)
# Number of elements: <nPHb>; order of phases: defined in <xPH> index 
# list in the DATACH file/structure.
# Zero values mean that the phase is unstable and is not present in the
equilibrium state
<xPH>
5.534209756e+01 0.0e+00 0.0e+00 2.0859011268e-04 0.0e+00 0.0e+00 0.0e+00 

# Volumes of the multicomponent phases (cm3), GEM output
# Number of elements: <nPSb>; order of phases: defined in <xPH> index 
# list in the DATACH file/structure.
<vPS>
9.99936471e+02 0.0e+00 

# masses of multicomponent phases (g), GEM output
# Number of elements: <nPSb>; order of phases: defined in <xPH> index 
# list in the DATACH file/structure.
<mPS>
9.97012581e+02 0.0e+00 

# bulk elemental compositions of multicomponent phases - GEM output, moles
# Number of elements: <nPSb>*<nICb>; order of phases ( <nPSb> rows): defined 
# in <xPH> index list in the DATACH file/structure; order of ICs ( <nICb> 
# columns): defined in the <xIC> index list in DATACH. 
# The whole row of zeros means that the respective phase is not present 
# in the equilibrium state.
<bPS>
1.2240959856e-04 1.2241000427e-04 2.0025031458e-07 1.106836964e+02 9.944034855e-08 5.5342235439e+01 4.170187181e-10 
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# amount of carrier (sorbent or solvent) in multicomponent phases (GEM output)
# Number of elements: <nPSb>; order of phases: defined in <xPH> index 
# list in the DATACH file/structure.
# This may be very useful e.g. in calculation of molal concentrations 
# of aqueous species. 
<xPA>
5.534176513e+01 0.0e+00 

# End of file
