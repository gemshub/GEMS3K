<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html><head>


<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"><title>GEMS3K User Manual</title>


<meta name="qrichtext" content="1"><style type="text/css">
p, li { white-space: pre-wrap; }
</style><meta name="qrichtext" content="1"><style type="text/css">
p, li { white-space: pre-wrap; } </style><meta name="qrichtext" content="1"><style type="text/css">
p, li { white-space: pre-wrap; }
</style><meta name="qrichtext" content="1"><style type="text/css">
p, li { white-space: pre-wrap; }
</style><meta name="qrichtext" content="1"><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style="background-image: url(bgimg-gray.jpg);">
<h1><img alt="GEMS-icon" src="gems1.png" style="width: 48px; height: 48px;" align="left"> <font style="color: black;" color="#000066">
GEMS3K Code for Solving for GeoChemical Equilibria</font> </h1>


<h2>The Standalone GEMS3K Code User Manual
</h2>


<hr size="2" width="100%">
<h3>Summary</h3>
<p>The GEMS3K code is a numerical kernel module of the <a href="http://gems.web.psi.ch/GEMS3/index.html">GEM-Selektor v.3 code package</a>
 for Gibbs energy minimization (GEM), enhanced with RAM- and 
file-system- data exchange interfaces without GUI in its standalone 
variant. GEM is a method of chemical thermodynamic modeling with 
emphasis on complex heterogeneous equilibria involving phases-solutions 
and sorption, implemented in a GEM-IPM-3 algorithm. </p>
<p>





The standalone GEMS3K code is designed for coupling GEM chemical 
solver with existing and new fluid-mass-transport (FMT) codes, 
parameters fitting codes, and other upper-level simulation tools. The 
GEMS3K source code is compatible with ANSI C++ and can be compiled on 
many computer platforms (Windows, Linux, Mac OSX, HPC Merlin, Cray XT, 
etc.) using various optimizing compilers (GNU C++, MinGW GNU C++, PGI 
C++, Intel C++, Microsoft C++, &#8230; ). <a href="gems3k-about.html">Check here for technical information</a> about code installation and building libraries and examples.



</p>
<p>
The input data can be provided in ASCII files (edited or exported 
from GEM-Selektor per mouse-click), the output can also be written in 
ASCII files. Alternatively, the whole data exchange with a transport 
code part can be performed in RAM using the DATACH and DATABR data 
structures. This data exchange interface is implemented in two C++ 
classes named TNode and TNodeArray. 



</p>
<p>
The TNode class provides functionality for attaching GEMS3K kernel to
 an existing transport simulation code, which keeps the chemical 
information for all nodes in its own memory, and calls a GEM calculation
 for each node separately. <a href="gems3k-nodelev.html">Check here</a> how to use the TNode interface in a coupled code.



</p>
<p>
The TNodeArray class is built on top of the TNode class and can store
 both chemical and dynamic data for all nodes of the mass transport 
problem; the re-calculation of equilibrium states after the mass 
transport step can be done with a single call (with internal 
parallelization possible); this may be suitable for developing of a new 
transport code (<a href="gems3k-nodearray.html">more...</a>). 



</p>
<p>
Both GEMS3K and GEM-Selektor codes are developed jointly at the Paul 
Scherrer Institute (NES LES) and at ETH Zurich (IGP ERDW). The 
standalone GEMS3K code is distributed open-source under the LGPL v.3 
license (<a href="gems3k-about.html">more...</a>).</p>


<br>



<br>


<hr style="width: 100%; height: 2px;">
<h3>Contents</h3>


<p><a href="#TAG_INTRO">1. Introduction</a></p>


<p><a href="#TAG_GEMIPM2">2. GEM IPM &#8211; the numerical kernel of GEM-Selektor</a> </p>


<blockquote><a href="#TAG_GEM_METHOD">2.1.
The Gibbs
Energy Minimization (GEM) method (brief overview) </a><br>
  <a href="#TAG-IPM2-ALGORITHM">2.2. The GEM IPM-3 algorithm (brief
overview)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; <br>
  <a href="#TAG_TMULTI">2.3. TMulti class - an implementation of the
GEM
IPM-3
algorithm</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <br>
  <a href="#TAG_MAKE_FILES">2.4. How to export GEMS3K input files from
the
GEM-Selektor
package</a><br>
</blockquote>


<p><a href="#TAG_GEMIPM2K">3. GEMS3K - a standalone GEM solver with data exchange interface</a></p>


<blockquote><a href="#TAG_DATACH">3.1.
DATACH data exchange structure for sharing
chemical
system definition (CSD)</a><br>
  <a href="#TAG_DATABR">3.2. DATABR data
exchange structure for
defining i/o data
for a single node system</a><br>
  <a href="#TAG_TNODE">3.3. TNode
class for
simple coupling of GEM IPM module to transport
codes</a><br>
</blockquote>


<p><a href="#TAG_PROGRAMMING">4. Programming and technical issues</a></p>


<blockquote><a href="#TAG_SVN">4.1.
Subversion repository of GEMS3K source code</a><br>
  <a href="#TAG_FMT_CPP">4.2.
Mass transport part in C++</a><br>
  <a href="#TAG_FMT_FORTRAN">4.3. Mass transport part in Fortran</a><br>
  <a href="#TAG_BUILD">4.4.
Building GEMS3K executables</a></blockquote>


<p><a href="#TAG_REFERENCES">5. References</a></p>


<hr size="2" width="100%">
<h2><a name="TAG_INTRO"></a>1. Introduction</h2>
<p>


Modern approaches to reactive mass transport (RMT) or fluid mass 
transport (FMT) modelling require simultaneous account for the mass 
transport of contaminants through aqueous and/or gas phase in 
subsurface, together with their interaction with wall-rock minerals by 
means of (ad)sorption, mineral (co)precipitation, dissolution, 
etc.&nbsp; These chemical processes are inherently complex; they depend 
on the redox state of the system, and may involve many phases and 
chemical species, some of which are kinetically dependent. Such 
interactions may adversely affect the mass transport via the porosity 
and permeability changes e.g. due to mineral dissolution or 
precipitation. 


</p>
<p>
Direct inclusion of all possible chemical reactions in the mass transport model is possible (e.g.[<a href="gemipm2k-man.html#Ref_Steefel_2009">Steefel and Maher 2009</a>]),
 but may render it intractable in 2D or 3D space. If this is the case, 
the chemical model must be dramatically simplified to a few reactions, 
which makes its chemical plausibility doubtful. The modeller must make 
(often arbitrary) decisions about which chemical interactions are 
relevant, and which ones can be neglected. 


</p>
<p>
An alternative "operator-splitting" approach would be to keep a 
complex enough chemical model in a kind of "black box" which can be 
applied separately to each node of the FMT model at each given time 
point <span style="font-style: italic;">t</span>.&nbsp; The&nbsp; input of the "chemical black box" at time <span style="font-style: italic;">t</span>  is just the vector of bulk chemical composition <span style="font-style: italic;">b</span> of the reactive part of the node, as well as temperature <span style="font-style: italic;">T</span>, pressure <span style="font-style: italic;">P</span>, and optionally, kinetic constraints <span style="font-style: italic;">k</span>
 on some reactions or amounts of certain components. Some or all of 
these inputs could have been changed by the mass transport part on its 
previous iteration time step <span style="font-style: italic;">t-</span>1.&nbsp;



</p>
<p>
The "chemical black box" equilibration is then applied to each node independently at time point <span style="font-style: italic;">t</span>, to produce changed speciation <span style="font-style: italic;">n</span>
 (amounts of chemical species in all reactive phases),&nbsp; new phase 
volumes, redox state (expressed in values of Eh, pe of aqueous solution,
 gas fugacities, etc.), chemical potentials of components, and so on. 
This procedure can also detect a disappearance of some phases or 
appearance of some new phases in some nodes (e.g., due to dissolution or
 precipitation of solids). 


</p>
<p>
After the "chemistry" run over all nodes is finished, the next time step of the FMT algorithm can be done for the time point <span style="font-style: italic;">t</span>+1, using the updated concentrations of mobile species in aqueous and/or gas phases at time <span style="font-style: italic;">t.</span>
 The FMT part redistributes the matter between nodes (subject to mass 
conservation), thus producing corrected compositions of reactive part of
 each node. So, the coupled RMT algorithm actually runs over all nodes 
twice at the time point <span style="font-style: italic;">t</span>:  once doing a mass transport iteration using node compositions obtained earlier (at <span style="font-style: italic;">t</span>-1), and then&nbsp; by applying the "chemical black box" to each node at time <span style="font-style: italic;">t</span>, producing the updated speciation which will be used by the FMT part at the next time point&nbsp; <span style="font-style: italic;">t</span>+1.


</p>
<p>
This idea of "operator-splitting" coupling is not really new and it 
has already been implemented in a number of coupled codes (PHREEQC, 
OpenGeoSys, MCOTAC, ....). These codes use different mass transport 
algorithms, but in most cases the same type of chemical solver based on 
the law of mass action (LMA) and the Newton-Raphson method for 
minimizing the mass balance deviations. However, another type of 
chemical solvers based on Gibbs energy minimization (GEM) can also be  
coupled with the FMT codes. 


</p>
<p>
Both LMA and GEM can solve the so-called forward chemical modeling 
problem, which consists in finding the concentrations (or amounts) and 
activities of chemical species in aqueous and other phases present in a 
complex chemical system in an equilibrium state defined by temperature <span style="font-style: italic;">T</span>, pressure <span style="font-style: italic;">P</span>, and the system bulk composition <span style="font-style: italic;">b</span>.
 In practice, calculations for solving such problems range from trivial 
to complex, depending on the number of species, phases, and 
stoichiometry units. The complexity further increases when several 
phases-solutions with redox sensitive components are included in the 
mass balance; a typical case is the aqueous - solid solution (Aq-SS) 
system which also involves a non-ideal fluid (gas mixture) phase. Even 
more complex systems can be considered, e.g. those involving 
(ad)sorption on several co-existing sorbents. 


</p>
<p>
Chemical speciation problems were traditionally solved with help of 
the LMA codes, supported with tools for calculation of Lippmann 
functions and saturation indexes. A good introduction into modern LMA 
chemical speciation numerical methods can be found in several textbooks [<a href="gemipm2k-man.html#Ref_Van-Zeggeren-1970">Van Zeggeren and Storey, 1970</a>; <a href="gemipm2k-man.html#Ref_Morel-Hering-1993">Morel and Hering, 1993</a>; <a href="gemipm2k-man.html#Ref_Bethke-1996">Bethke, 1996</a>] and in the manuals of speciation codes such as PHREEQC [<a href="gemipm2k-man.html#Ref_Parkhurst-Appelo-1999">Parkhurst and Appelo, 1999</a>] or CHESS [<a href="gemipm2k-man.html#Ref_van-der-Lee-1998">van der Lee, 1998</a>].



</p>
<p>
The advantages of LMA - excellent mass balance accuracy and fast 
convergence - are best revealed in the case of simple aqueous
speciation models with known stable pure solid phase assemblage and 
known Eh and fugacities of gases. The LMA codes require thermodynamic 
data only for the product species (usually aqueous/surface complexes, 
minerals, and gases), but not for the master species (usually aqueous 
ions) - this "input data economy" can also be viewed as an advantage in 
some cases.


</p>

<p><a name="CRITIQUE-LMA"></a>However, solving with LMA codes the 
complex equilibria that involve aqueous electrolyte, many possible 
condensed phases (including solid solutions or fluids) is, in general, 
an inefficient process. Different approaches to this problem are used in
 LMA chemical solvers. In the Geochemists Workbench [<a href="gemipm2k-man.html#Ref_Bethke-1996">Bethke,2008</a>],
  any pure mineral phase is taken as master species. Because there is no
 way to mix master species, this program cannot handle solid solutions 
or gas mixtures at all. Other LMA codes (such as PHREEQC) consider 
minerals and gases as product species. As pointed by [<a href="gemipm2k-man.html#Ref_Reed-1982">Reed, 1982</a>],
 usually no solids are taken into mass balance in the initial speciation
 calculation; after it is done, the saturation indexes are computed for 
each stoichiometrically feasible mineral phase, the mineral with the 
highest supersaturation is included into the mass balance, the 
speciation is computed again, and this loop is repeated until no 
supersaturated phases are left in the list. 



</p>
<p>
The real problem in LMA approach is how to determine the saturation 
index of the solid solution phase or of the gas mixture. For the ideal 
(solid) solution, this can be done over iterations using ionic 
activities available from aqueous speciation. For non-ideal SS, this is a
 problem which has no general solution, as explained on Page 94 in [<a href="gemipm2k-man.html#Ref_Bruno_ea_2007">Bruno et al, 2007</a>].
 Because of that, the LMA chemical solvers can at best treat only ideal 
solution phases and simple binary non-ideal solid solutions that can be 
described using Lippmann functions and diagrams. If many solids and/or 
solid solutions are potentially present,&nbsp; a simple LMA aqueous 
speciation calculation turns into a series of many runs controlled by 
non-rigorous test procedures for selecting (over)saturated solids 
one-by-one, without a theoretical guarantee of convergence to a unique 
result. This kind of retardation is difficult to evaluate, but, with a 
large list of possible condensed phases, more than ten LMA loops may be 
required to include all stable solids into mass balance.


</p>
<p>
A complementary GEM (Gibbs Energy Minimization) method of 
thermodynamic modeling has been implemented in several computer codes 
such as ChemSage/ FactSage (http://www.factsage.com); Gibbs/HCh [<a href="#Ref-Borisov-1992">Borisov &amp; Shvarov, 1992</a>]; Selektor-C [<a href="#Ref_Karpov-ea-2001">Karpov et al., 2001</a>]; and GEM-Selektor ([<a href="gemipm2k-man.html#Ref_Kulik-ea-2004">Kulik et al., 2004</a>];
 http://gems.web.psi.ch). GEM algorithms can solve complex chemical 
equilibria in a straightforward way. The applicability of GEM is limited
 only by the knowledge of standard-state molar properties of end-members
and the non-ideal interaction parameters of mixing in each 
multi-component phase. In the following description, mainly the convex
programming approach to GEM will be considered [<a href="gemipm2k-man.html#Ref_Karpov-ea-1997">Karpov et al., 1997</a>; <a href="gemipm2k-man.html#Ref_Karpov-ea-2001">2001</a>], as implemented in GEMS3K and GEM-Selektor v.3 code [<a href="gemipm2k-man.html#Ref_Kulik-ea-2004">Kulik et al., 2004</a>] that contains a variant of Nagra/PSI chemical thermodynamic data base [<a href="#Ref-Hummel-2002">Hummel et al, 2002</a>]. 


</p>
<p>
The GEM method computes simultaneously the primal (amounts of 
dependent components and their activity coefficients) and the dual 
(chemical potentials of independent components) solutions. From the 
latter, other thermodynamic quantities (activities, concentrations, pH, 
pe) and criteria of equilibrium are obtained. If non-ideal phases are 
included then the activity
coefficients of their components are adjusted on each GEM iteration and 
come out as part of the primal solution.


</p>
<p>
In comparison with chemical models based on the law of mass action 
(LMA, such as PHREEQC or MINEQL) so far mainly used in coupled 
FMT-chemistry codes, GEM has advantage that it can handle any number of 
potentially possible phases, including any number of (highly) non-ideal 
solutions, which slow  the convergence  only moderately down (see details in <a href="gemipm2k-man.html#Ref_Bruno_ea_2007">[Bruno et al., 2007</a>],
 p.90-104). From bulk chemical composition, temperature and pressure, 
GEM calculates amounts and activities of all components in all stable 
phases, plus any activity-derived quantities such as gas fugacity, pH 
and Eh. Volumes of all phases present in the (node) reactive system can 
be found when the standard molar volumes for their components are 
provided in thermodynamic database. The disadvantages of GEM in 
comparison to LMA codes are much slower convergence and generally worse 
mass balance precision. The latter can be greatly improved at cost of a 
few additional iterations and using the internally consistent 
thermodynamic data [<a href="gemipm2k-man.html#Ref_TM-44-02-06">Chudnenko ea, 2002</a>]. 


</p>
<p>
The present GEMS3K code is a GEM-Selektor kernel chemical solver 
equipped with a data exchange interface that makes it possible to couple
 any existing FMT code with the GEM&nbsp; "chemical black box" to 
produce a coupled modeling code with high chemical plausibility. As in 
standalone GEMS3K code there is no GUI and data exchange occurs via 
files or directly in
computer RAM, such code can be parallelized and compiled on various 
platforms up to HPC clusters.&nbsp; 


</p>
<p>
The traditional "operator-splitting" coupling, where the chemical 
information for all nodes is stored in the mass transport part which 
calls the chemical solver for each node one-by-one, is supported by the 
TNode C++ class. When a new FMT code is written, the whole data storage 
for all nodes can also be organized (using a TNodeArray C++ class) into 
node arrays, with each
node accessible from the GEM IPM-3 routines or from the FMT program. 


</p>
<p>
This document describes the structure of GEMS3K program and the data 
exchange interface (DATACH and DATABR structures), followed by an 
overview of TNode and TNodeArray classes and examples of their usage 
(see also another document&nbsp; <a href="gems3k-useref.html">GEMS3K User Reference.html</a>  for detail on using TNode class functions). In a companion document <a href="gems3k-iofiles.html">gems3k-iofiles.html</a>,
 the format of GEMS3K text input/output files is described together with
 the reference for data objects encountered in these files. Most of 
these data objects are the same as in GEM-Selektor package or similar; 
links are
provided wherever necessary.</p>




<br>


<hr size="2" width="100%">
<h2><a name="TAG_GEMIPM2"></a>2. GEM IPM-3 &#8211; the numerical kernel of
GEM-Selektor </h2>
<p>


GEMS3K package is a set of C++ classes and functions extracted from the GEM-Selektor code package for thermodynamic
modelling by Gibbs energy minimization (GEM), available at <a href="http://gems.web.psi.ch/GEMS3K/">http://gems.web.psi.ch/GEMS3K/</a>.
 The satndalone GEMS3K code implements the same GEM IPM-3 chemical 
solver as in GEM-Selektor, linked to TMulti C++ class and data 
structure, enhanced with RAM- and file- data exchange interfaces 
implemented in TNode and TNodeArray classes, but cut from the 
GEM-Selektor graphical user interface, database engine, and script 
interpreter.


</p>
<p>
The GEMS3K code has been designed for coupling the GEM IPM-3 chemical
 solver with existing and new fluid mass-transport (FMT) codes. The 
program source code is compatible with ANSI C++ and can be compiled on 
many computer platforms (Windows, Linux, HPC Merlin, Cray XT, etc.) 
using many optimizing compilers (GNU C++, PGI C++, Intel C++, Microsoft 
C++, &#8230; ). 


</p>
<p>
The input data can be provided in human-readable ASCII files, the 
output can also be written in ASCII files. Alternatively, the whole data
 exchange with a transport code part can be performed in RAM using&nbsp;
 DATACH and&nbsp; DATABR data structures.
This data exchange interface is implemented in two C++ classes &#8211; TNode 
and TNodeArray. 


</p>
<p>
The TNode class provides functionality for attaching the GEM IPM-3 
kernel module to an existing transport model code which keeps the 
chemical information for all nodes and calls GEM calculation for each 
node separately. The TNodeArray class is built on top of the TNode class
 and can store both chemical and dynamic data for all nodes of the mass 
transport problem. Recalculation of equilibrium states in all nodes 
after the mass transport step can be done with a single call (with
internal parallelization possible). This may be suitable for developing 
of a new coupled code. The GEMS3K code is distributed open-source under 
LGPL v.3 license.</p>




<br>


<hr size="2" width="100%">
<h3><a name="TAG_GEM_METHOD"></a>2.1. The Gibbs Energy
Minimization (GEM) method (brief overview)<span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;" lang="DE-CH"></span></h3>
<p>


In GEM approach
[for details, see <a href="#Ref_Karpov-ea-1997">Karpov
et
al., 1997</a>; <a href="#Ref_Karpov-ea-2001">Karpov et al., 2001</a>; <a href="#Ref_Kulik-ea-2004">Kulik
et al., 2004</a>; <a href="#Ref_Kulik_ea-2012">Kulik
et al., 2012</a>], the total mole
amounts of
chemical
elements <span style="font-style: italic;">n<sub>i</sub></span><sub> </sub>and
(zero)
charge <span style="font-style: italic;">n<sub>z</sub></span> comprise
the
input bulk composition of the chemical system expressed using <span style="font-style: italic;">n</span>(<span style="font-style: italic;">N</span>)
Independent Components
(IC). All&nbsp; <span style="font-style: italic;">n</span>(<span style="font-style: italic;">L</span>) stoichiometrically
feasible chemical species or Dependent Components (DC) are taken
into the mass balance
through their chemical formulae and mole amounts <span style="font-style: italic;">n<sub>j</sub></span>. A given <span style="font-style: italic;">j</span>-th DC belongs to a single- or
multi-component aqueous, gaseous, fluid, liquid, solid, or sorption
phase.
The stability of <span style="font-style: italic;">j</span>-th DC at
temperature <span style="font-style: italic;">T</span> and pressure <span style="font-style: italic;">P</span>
of
interest is defined by its molar Gibbs energy function <span style="font-style: italic;">g<sub>T,P</sub></span>. Activities and
concentrations
of DCs are treated separately in each phase, taking
into account appropriate standard and
reference states, concentration scales, and models of (non)ideal
mixing.</p>
<p>


The <st2:stockticker w:st="on">GEM</st2:stockticker>
problem consists in calculation of (yet unknown) equilibrium phase
assemblage
and speciation in the system defined by <i>P, T,</i><span style=""><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span>bulk
composition
(expressed in amounts of independent components), thermodynamic data
for
dependent components, and, optionally, parameters of models of
non-ideal mixing
in multi-component phases. Solving this problem means finding mole
amounts of
dependent components<span style=""> </span><big><i style="">n</i><sup>(<i style="">x</i>)</sup> = <st1:citation w:st="on">{<i style=""> n</i><sup>(<i style="">x</i>)</sup><i style=""><sub>j</sub></i>, <i style="">j</i><span style="font-family: Symbol;"><span style=""><span style="font-style: italic;"> </span></span></span></st1:citation></big>belongs to<big><st1:citation w:st="on"><i style=""> L</i>}</st1:citation></big>&nbsp; such
that:<span style=""><o:p></o:p></span></p>



<p><big><i><span style="font-size: 12pt;" lang="EN-GB">G</span></i><span style="font-size: 12pt;" lang="EN-GB">(<i>n</i><sup>(<i style="">x</i>)</sup>)<i>
</i></span><span style="font-size: 12pt; font-family: Symbol;" lang="EN-GB"><span style="">-&gt;</span></span></big><span style="font-size: 12pt;" lang="EN-GB"><big> min<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>subject to<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><i style="">A<span style="">n</span></i><sup>(<i style="">x</i>)</sup><i style=""> =n</i><sup>(<i style="">b</i>)</sup></big><span style=""><big>&nbsp;</big>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style="">&nbsp; </span></span><span lang="EN-GB"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-size: 12pt;" lang="EN-GB"><o:p></o:p></span></p>
<p>


where<span style="font-family: Helvetica,Arial,sans-serif;"> </span><big><i style="">n</i><sup>(<i style="">b</i>)</sup><i> </i>= <st1:citation w:st="on">{<i style=""> n</i><sup>(<i style="">b</i>)</sup><i><sub>i</sub></i>,
<i>i&nbsp;</i><span style="font-family: Symbol;"><span style=""></span></span>
<i>N</i>}</st1:citation></big><i><span style=""> </span></i>is the
input vector of amounts of independent components (IC,
stoichiometry units, master species) with indexes belonging to the set<span style="">
</span><big><i style="">N</i>; <i>A </i>= <st1:citation w:st="on">{<i>a<sub>ij</sub></i>,
<i>i </i><span style="font-family: Symbol;"><span style=""></span></span></st1:citation></big>belongs to<big><st1:citation w:st="on"></st1:citation></big><big><st1:citation w:st="on"><span style="font-family: Symbol;"><span style=""></span></span>
<i>N, j </i><span style="font-family: Symbol;"><span style=""></span></span></st1:citation></big>belongs to<big><st1:citation w:st="on"></st1:citation></big><big><st1:citation w:st="on"><span style="font-family: Symbol;"><span style=""></span></span>
<i>L</i>}</st1:citation></big><i><span style=""> </span></i>is a
matrix made of the formula stoichiometry
coefficients of dependent components (DC, product species with indexes
comprising the set<span style=""> <big><span style="font-style: italic;">L</span></big></span>); and <big><i style="">G</i>(<i>n</i><sup>(<i style="">x</i>)</sup>)</big><span style=""><big> </big></span>is a total Gibbs
energy function of the system:</p>





<p><big><i><span style="font-size: 12pt;" lang="EN-GB">G</span></i><span style="font-size: 12pt;" lang="EN-GB">(<i>n</i><sup>(<i style="">x</i>)</sup>)
= SUM(<span style="font-style: italic;"> v</span></span></big><big><i style=""><sub>j</sub></i></big><big><span style="font-size: 12pt;" lang="EN-GB"><span style="font-style: italic;"></span> </span></big><big><i style="">* n</i><sup>(<i style="">x</i>)</sup></big><big><i style=""><sub>j</sub></i></big><big><span style="font-size: 12pt;" lang="EN-GB"> ), &nbsp;&nbsp; </span></big><big><i style="">j</i><span style="font-family: Symbol;"><span style=""><span style="font-style: italic;"> </span></span></span></big>belongs to<big><st1:citation w:st="on"></st1:citation></big><big><span style="font-family: Symbol;"><span style=""></span></span><i style=""> L</i></big></p>


<p>


Here<span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"><span style="font-family: Helvetica,Arial,sans-serif;">,</span> </span><big><span style="font-size: 12pt;" lang="EN-GB"><span style="font-style: italic;">v</span></span></big><big><i style=""><span style="font-size: 12pt; font-family: Symbol;"><span style=""></span></span><sub><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">j</span></sub></i></big><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"> </span>is
the normalized
primal chemical potential of j&#8211;th dependent
component, calculated for each DC from its standard molar
Gibbs energy function, concentration and activity coefficient taken in
the appropriate scale (molal for aqueous species, mole fraction for
solid solutions etc.). Activity
coefficients are
functions of the
respective phase composition and interaction parameters; they are
calculated between
GEM iterations according
to the
model of non-ideal mixing chosen for each phase. For aqueous
electrolyte,
various modifications of the Debye-Hückel equation are commonly
used for low-to-moderate ionic strength, as well as SIT and Pitzer
models for high dissolved salt concentrations. <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"></span></p>





<p><span style="">The <i>Interior
Points Method</i>
(IPM) non-linear <st2:stockticker w:st="on">GEM</st2:stockticker>
algorithm finds simultaneously two vectors &#8211; the <i>primal</i> <span style="position: relative; top: 5pt;"></span></span><big><i style="">n</i><sup>(<i style="">x</i>) </sup></big><span style="">and
the <i style="">dual
</i></span><big><i style="">u</i></big><a href="#Ref_Karpov-ea-1997"> Karpov et al, 1997</a>] <span style="font-family: Helvetica,Arial,sans-serif;"><o:p></o:p></span>solution vectors of
the GEM problem using the Karush-Kuhn-Tucker
necessary and sufficient conditions of
equilibrium state, which in vector-matrix form look like</p>
<p>
<big><i style=""><span style="font-size: 12pt; font-family: Symbol;"><span style=""></span></span></i></big><big><span style="font-size: 12pt;" lang="EN-GB"><span style="font-style: italic;">v</span></span></big><big><i style=""><span style="font-size: 12pt; font-family: Symbol;"><span style=""></span></span><sub><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"></span></sub></i></big><big><i style=""><span style="font-size: 12pt; font-family: Symbol;"><span style=""> - </span></span></i><i style="font-family: Times New Roman,Times,serif;">A<sup>T</sup>u &gt;=
</i><span style="font-family: Times New Roman,Times,serif;">0</span><i style="font-family: Times New Roman,Times,serif;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</i></big><span style="font-size: 12pt; font-family: Times New Roman,Times,serif;" lang="EN-GB"><big><i style="">A<span style="">n</span></i><sup>(<i style="">x</i>)</sup><i style=""> =n</i><sup>(<i style="">b</i>)</sup></big><span style=""><big>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </big></span><big><i style=""><span style="">n</span></i><sup>(<i style="">x</i>) </sup></big></span><big style="font-family: Times New Roman,Times,serif;"><i>&gt;=
0;&nbsp;&nbsp;&nbsp;&nbsp; </i></big><big style="font-family: Times New Roman,Times,serif;"><i style=""><span style="">n</span></i><sup>(<i style="">x</i>)</sup>(</big><big style="font-family: Times New Roman,Times,serif;"><i style=""><span style="font-size: 12pt;"><span style="">v - </span></span></i><i>A<sup>T</sup>u</i></big><big style="font-family: Times New Roman,Times,serif;">) = 0</big><br>
</p>
<p>


where <sup style="font-family: Times New Roman,Times,serif;"><span style="font-style: italic;">T</span></sup> is the transpose
operator.&nbsp; <span style="font-size: 12pt; letter-spacing: -0.2pt;">The
last condition of <i style="">orthogonality</i> zeroes off
the molar amounts of unstable species and phases. The
Karush-Kuhn-Tucker conditions were also extended
for the case when the sought-for amounts <span style="position: relative; top: 6pt;"></span>of
some metastable species are constrained
from below and/or above to model &#8220;partial equilibrium&#8221; states </span><st1:citation w:st="on"><span style="font-size: 12pt;">and simulate kinetics [<a href="#Ref_Karpov-ea-2001">Karpov et al., 2001</a>]</span></st1:citation><span style="font-size: 12pt; letter-spacing: -0.2pt;">.</span></p>



<span style="font-size: 12pt; font-family: Times; letter-spacing: -0.2pt;"> </span>
<p>
It is an advantage
of
GEM method (in "convex programming" variant) that it yields two
solutions - the "primal" <big style="font-family: Times New Roman,Times,serif;"><i style=""><span style="">n</span></i><sup>(<i style="">x</i>)</sup></big><span style="font-style: italic; font-family: Times New Roman,Times,serif;"></span>
for speciation
(analogous to LMA) and the "dual" <big><span style="font-style: italic; font-family: Times New Roman,Times,serif;">u</span></big>
for chemical potentials of independent components (not available from
LMA solvers). The dual solution
may open
innovative ways to constructing mass transport models for
diffusion-dominated systems, since the
diffusion of any component may be considered as being driven by the
gradient of its chemical
potential.</p>



<br>


<hr size="2" width="100%">
<h3><a name="TAG-IPM2-ALGORITHM"></a>2.2. The GEM IPM-3 algorithm
(brief overview) </h3>


<h3> </h3>
<p>


The GEM IPM3 algorithm is described in more detail in a paper [<a href="#Ref_Kulik_ea-2012">Kulik et al., 2012</a>] , as well as in earlier report [<a href="#Ref_TM-44-02-06">Chudnenko et al., 2002</a>]. A short overview is given in [<a href="#Ref_Bruno_ea_2007">Bruno et al., 2007</a>], pages 94-104. The mass balance precision and speed of GEM IPM-3 calculations have been dramatically increased [<a href="#Ref_Dmytrieva-2008">Dmytrieva et al., 2009</a>] and now are comparable with that of LMA codes, at least in "smart initial approximation" SIA mode. 


</p>
<p>
The basic idea of the GEM IPM algorithm consists in finding such a distribution vector <span style="font-style: italic;">n </span>of bulk chemical composition of
the system <span style="font-style: italic;">b</span> over its thermodynamic phases and their components that the total Gibbs energy <span style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>)
 of the system is at minimum at temperature and pressure of interest. 
Each phase component (chemical species) is represented by its 
stoichiometry and the standard chemical potential (molar Gibbs energy 
function <span style="font-style: italic;">g</span><sup>o</sup>(<span style="font-style: italic;">T,P</span>)) at temperature <span style="font-style: italic;">T</span> and pressure <span style="font-style: italic;">P</span> of interest. As seen on Fig. 2-1, the process consists of four major steps. 




</p>
<p style="font-family: Helvetica,Arial,sans-serif;"><img style="width: 640px; height: 780px;" alt="IPM flowchart" title="GEM IPM general flowchart" src="FlowChartOfIPM-3-Algorithm.png"><br>
</p>




<p>Fig. 2-1. Simplified flowchart of the GEM IPM-3 algorithm</p>





<p><a name="INITIAL_APPROXIMATION"></a>The <u>first stage</u> is to obtain an initial approximation of the <span style="font-style: italic;">n</span> vector which is close enough to the <span style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>)
 minimum, so that the GEM process would succeed in finding the solution 
of the problem. In principle, any previously calculated speciation 
vector<span style="font-style: italic;"> n</span> for this setup of thermodynamic system (even for different <span style="font-style: italic;">b, T, P</span>)
 can be used as initial approximation in "smart initial approximation" 
(SIA) mode. If no previous solution is available at all, or the 
available one is bad, then the so-called "automatic initial 
approximation" (AIA) must be obtained by solving a linear programming 
(LP) sub-problem using a modified simplex method. 



</p>
<p>
The LP sub-problem is constructed by truncating all the mixing terms 
from chemical potential expressions for all components of 
phases-solutions, which is equivalent to considering any component as a 
pure phase. Given <span style="font-style: italic;">n</span>(<span style="font-style: italic;">N</span>) Independent Components (usually chemical elements and charge) in the bulk composition vector <span style="font-style: italic;">b</span>, the simplex solution contains at most <span style="font-style: italic;">n</span>(<span style="font-style: italic;">N</span>) non-zero elements in the AIA speciation vector <span style="font-style: italic;">n</span>(AIA). This is also consistent with the Gibbs phase rule. The <i>n</i>(AIA)
 vector contains many zero amounts of chemical species (dependent 
components) which may be relevant aqueous species or form stable 
condensed or fluid phases, although this is not a priori known. For that
 reason, the zero mole amounts in the AIA initial approximation are 
filled out with a default amount (1e-6 - 1e-5 mol) which then would 
increase or decrease upon GEM iterations depending on the stability of 
the chemical species in this chemical system.


</p>
<p>
Usually, the number of aqueous species is greater than <span style="font-style: italic;">n</span>(<span style="font-style: italic;">N</span>). If the number of stoichiometrically possible phases exceeds n(N), such system is called a "multisystem" [<a href="#Ref_Karpov-ea-1997">Karpov et al., 1997</a>]. Equilibria in multisystems cannot be solved directly by LMA algorithm (see a <a href="#CRITIQUE-LMA">comment here</a>), but such equilibria can be solved in one GEM run, if the initial approximation belongs to the so-called "feasible domain". 



</p>

<p><a name="MBR_PROCEDURE"></a>So, the <u>second stage</u> - a special MBR() algorithm - consists in checking whether the AIA or SIA vector <span style="font-style: italic;">n</span>
 is feasible, i.e. whether the mass balance residuals for all 
independent components are small enough. This is usually so in the case 
of previously available SIA vector, but not so for the <i>n</i>(AIA) vector.&nbsp; If the current amount of <span style="font-style: italic;">j</span>-th species <span style="font-style: italic;">n<sub>j</sub></span> falls below a certain numerical threshold (ca. 1e-30 mol), it will be zeroed off. This eliminates the <span style="font-style: italic;">j</span>-th
 species from subsequent GEM iterations in order to avoid numerical 
troubles. However, if the total amount of a phase falls below another 
threshold (Pa_DS between 1e-12 and 1e-20 mol) then all components in 
this phase will be zeroed off and the whole phase is eliminated from 
next GEM iterations.


</p>
<p>
On each iteration, the MBR() algorithm checks the mass balance 
residuals and tries to change the largest elements of the AIA vector in 
such a way that the mass balance accuracy would be at least satisfactory
 (i.e. deviations less than 1e-12 mol). This is usually done in a few 
iterations, and then the initial approximation vector is ready for the 
main GEM algorithm. 


</p>

<p><a name="GEM_PROCEDURE"></a>The <u>third stage</u> - the Main IPM Descent algorithm - adjusts the elements of <span style="font-style: italic;"></span>speciation vector <span style="font-style: italic;">n</span> to minimize the total Gibbs energy of the system <span style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>)
 while keeping mass balance deviations the same or lower as inherited 
from the MBR() step. This is the core of GEM approach that uses the 
duality (Kuhn-Tucker) theorem by introducing Lagrange multipliers <span style="font-style: italic;">u<sub>i</sub></span> conjugate to the elements <span style="font-style: italic;">b<sub>i</sub></span>
 of the bulk composition vector. These Lagrange multipliers form the 
so-called "dual solution" of the GEM problem (the "primal solution" 
being the <span style="font-style: italic;">n</span> speciation vector). The total Gibbs energy of the system can be calculated either as <span style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>) = sum(<span style="font-style: italic;">n<sub>j</sub> v<sub>j</sub></span>) where <span style="font-style: italic;">v<sub>j</sub></span> = <span style="font-style: italic;">f</span>(<span style="font-style: italic;">g</span><sup>o</sup><sub><span style="font-style: italic;">j</span></sub>, <span style="font-style: italic;">n</span>) is the primal chemical potential of j-th dependent component., or as <span style="font-style: italic;">G</span>(<span style="font-style: italic;">b</span>) = sum(<span style="font-style: italic;">b<sub>i</sub> u<sub>i</sub></span>). Towards equilibrium, <span style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>) scalar value approaches a (global) minimum which equals the <span style="font-style: italic;">G</span>(<span style="font-style: italic;">b</span>) (global) maximum. Hence, the criterion of convergence can be constructed using any normalized function of <span style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>) - <span style="font-style: italic;">G</span>(<span style="font-style: italic;">b</span>)
 which is ideally zero, but numerically must be below a small threshold 
(for the quadratic Dikin's criterion, DK &lt; Pa_DK = 1e-6).&nbsp; 


</p>
<p>
Each iteration of the IPM Descent consists of three steps. First, a new dual solution approximation <span style="font-style: italic;">u</span>
 is found by solving with the Cholesky decomposition method a SLE 
constructed from the previous primal solution, stoichiometry matrix, and
 weight multipliers. Next, the vector of descent direction is found by 
comparing primal and dual chemical potentials for each dependent 
component. Finally, a step length multiplier is determined from a 
condition that no new <i>n<sub>j</sub></i> value should break the "feasible domain" of mass balance and metastability constraints. The new approximation of the <span style="font-style: italic;">n</span>
 speciation vector is found by incrementing non-zero elements of the old
 one with a product of the  respective element of the descent direction 
vector and the scalar step length. Convergence is usually achieved in 1 
to 10 iterations in the SIA and 20 to 200 iterations in the simplex AIA 
case. 


</p>

<p><a name="PSSC_PROCEDURE"></a>The <u>fourth stage</u> is called "phase
 selection" (implemented in the PhaseSelection() function). It consists 
in calculation of a phase stability index for each multi-component phase
 present in non-zero amount, as well as for each pure phase, either in 
the mass balance or not. The stability index is computed mainly from the
 dual solution vector u and stoichiometry of phase components. For any 
stable phase, the stability index (in logarithmic scale) must be close 
to zero.&nbsp; However, if the initial approximation was bad, or there 
were errors in stoichiometry or <span style="font-style: italic;">g</span><sup>o</sup> value for a dependent component, <span style="font-style: italic;"></span>
 the value of stability index may indicate that a phase present in the 
mass balance is unstable and must be excluded, or vice versa - a phase 
absent from the mass balance (zeroed off) is stable and must be 
included. If any such phase has been detected, it is zeroed off 
respectively its component amounts are filled out with small amounts, 
and the whole sequence is repeated from Step two (but without the 
overall fill-out step). If, after three to five such refinement loops, 
the PhaseSelection() still finds inconsistent phases, the behavior of 
GEM IPM algorithm depends on the original initial approximation. If it 
was SIA, the mode is automatically switched to AIA and calculation begin
 "from scratch", i.e. from solving the LP sub-problem for a generic IA. 
If it was AIA, an error message is generated and the GEM solution is not
 accepted.&nbsp; 


</p>
<p>
All these numerical paths of the iterative GEM IPM-3 algorithm are 
controlled using ca. 20 thresholds and flags, values of which were 
empirically found in many test and modelling calculations in various 
systems. These <a href="gems3k-ipm.html">numerical controls</a> can be adjusted in the GEM-Selektor Project module window, or in the <span style="font-family: monospace;">*ipm.dat</span>  input file of the GEMS3K standalone program, as described in the <a href="gems3k-iofiles.html">companion manual</a>. </p>




<br>


<hr size="2" width="100%">
<h3>&nbsp;<a name="TAG_TMULTI"></a>2.3. TMulti class - an
implementation of the GEM
IPM-3 algorithm<span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"><br>
</span></h3>
<p>


Algorithms described in the previous section &#8211; the GEM IPM-3 kernel - are implemented in the TMulti class (see <tt>ms_multi.h</tt> file). This C++ class includes a work structure called <tt>MULTI</tt>, as well as a number of supplementary data
structures and functions. Before starting the GEM IPM calculation, all input data arrays in the <tt>MULTI</tt> work instance must be filled out. 

</p>
<p>
In the GEM-Selektor code, most of this data is taken from the work instance of <tt>TSyst</tt> class (<tt>SYSTEM</tt> data structure) and from the work instance of <tt>TMTparm</tt> class (<tt>MTPARM</tt> data structure), both connected to the <tt>RMULTS</tt>
 data structure containing
lists of components and phases included into a GEM-Selektor modeling 
project. This data is 98% accessible through GEM-Selektor module 
windows. Upon collecting the information into the <tt>MULTI</tt> 
structure, the data for all components and phases that have been 
switched off will be skipped automatically, i.e. the chemical system 
definition will be compressed.&nbsp; 

</p>
<p>
In the GEMS3K code, the only way to exchange input and output data with the GEM IPM kernel (and the work instance of the <tt>MULTI</tt> data structure) is using <tt>TNode</tt> class functions that access the <tt>DATACH</tt> and <tt>DATABR</tt>
 structures. One way is to read the DCH, IPM and DBR input files of 
GEMS3K; another way (used in coupled reactive transport codes) is to 
exchange data directly in computer memory (see <a href="gems3k-useref.html">User Reference file</a> and doxygen-style documentation). 


</p>
<p>
The format and content of GEMS3K I/O files are described in the <a href="gems3k-iofiles.html">I/O File Formats</a>
 documentation file. In the text
variant, these I/O files can be typed by the user with help of a simple 
ASCII text editor. However, it is highly recommended to export them from
 the GEM-Selektor code, which can save a lot of work time, especially 
when the coupled modeling must be performed at temperatures and 
pressures varying from node to node or with time. This is more than just
 technical issue. It is essential to investigate the behavior and the 
stiffness of the chemical system in
detail (by performing GEM-Selektor runs that simulate irreversible 
mixing, oxidation/reduction, or titration) before inserting it into the 
coupled reactive transport model, calculation of which is far more 
expensive. Exporting the DCH, IPM and DBR files in GEM-Selektor is quite
 easy, as outlined in the next section.</p>




<br>


<hr size="2" width="100%">
<h3><a name="TAG_MAKE_FILES"></a>2.4. How to make GEMS3K input
files using the
GEM-Selektor package</h3>
<p>


It is possible to produce a set of DCH, IPM and DBR files readable by
 GEMS3K for any single chemical system that has been set up and 
calculated in GEM-Selektor at least once. The description below is also 
available in the GEM-Selektor
runtime help database. First, refer to the help tutorial there for 
learning how to make a GEM-Selektor modeling project and
set up the chemical system of your interest in a new SysEq record.


</p>
<h4>How
to Write and Read GEMS3K I/O Files From the Single System Dialog</h4>
<p>


This method produces one DCH, one IPM and one DBR file for a given 
single chemical system definition and GEM task. How to read these files 
in is <a href="#HOWTO_READ_IN">described here</a>.


</p>
<p>
In the Single System dialog, calculate and save the desired SysEq 
record. Then click on "Data" "Export GEMS3K files..." menu command. This
 opens the "Setup for writing GEMS3K input files" dialog, which 
bydefault looks like this:


</p>
<p><img style="width: 576px; height: 569px;" alt="SetupWritingGEMS3KfilesDialog.png" src="SetupWritingGEMS3KfilesDialog.png"><br>
</p>
<p>




In the upper group, you have a choice to write GEMS3K files in text 
mode (default) or in binary mode. Activating the "Do not write data 
items that contain only default values" will result in much smaller IPM 
and DBR files because only data and numerical settings that differ from 
default values will be written; by reading these files, GEMS3K will 
assume default values for all data objects that are not present in the 
input files. Note that this makes sense to do if you are sure that you
work with the same GEMS3K version in both GEM-Selektor and the coupled 
code. The next option ("Write files with comments..."), if deactivated, 
results in much more compact though less human-readable text input 
files. The last option ("Include node transport properties into DBR 
file") should be unchecked (default) when exporting files for coupled 
codes such as OGS-GEMS where all such information is kept in the 
transport part of the code. The topmost option "Select ICs, DCs, and 
phases to be exchanged via DATABR file...",&nbsp; if activated, can be 
used for setting up very compact DBR files that only contain items that 
will change in standalone or coupled calculations (yet untested; more 
about this here ...); normally, just leave it unchecked (default). 



</p>
<p>
The middle group can be used to set up the lookup arrays with 
thermodynamic data (to be written at the end of the DCH file). This 
group consists of two iterators - one for pressure and one for 
temperature. In the simplest case such as shown above, the data will be 
calculated for one pressure and one temperature, which are taken over 
from the current GEM task. 



</p>
<p>
However, if coupled-code calculations will be performed with variable
 temperature and pressure, a look-up array must be exported. In this 
case, the user must specify wide enough pressure and temperature 
intervals (in Min. and Max. fields on both sides) and the step values 
such that at least 10 grid points will be created for pressure and 10 to
 40 grid points for temperature (or less to keep the temperature step 
greater than 3 - 5 degrees). The "Tolerance" fields define the area 
around grid points where interpolation will not be done and values 
corresponding to the grid point will be extracted directly, if T and P 
fall within tolerances at this point.


</p>
<p>
The lower group settings let the user to fine-tune the setup of look-up arrays and their T,P grid values after the pressure and
temperature iterators have been set up. 



If the checkbox "Enter pressure and temperature values" is activated,
 a next page of the dialog will appear showing values of pressure and 
temperature, automatically generated from P and T iterators using the 
interval and step size set there. If necessary, these values of P and T 
can be modified by the user, then the program will use them to construct
 and export the look-up array data. This occurs differently, depending 
on the "Disable Interpolation" checkbox state. 



If this checkbox is not checked (default), the usual P,T grid 
consisting of nP*nT (P,T) points will be generated, and interpolation 
will be enabled in the whole P and T intervals space. The number nP of 
pressure grid points can be different from the number nT of temperature 
grid points. 



</p>
<p>
However, if the "Disable Interpolation" checkbox is checked, nT will 
be set equal to nP, and only nP (P,T) pairs will be used as a grid to 
generate and export the look-up arrays of thermodynamic data; the 
interpolation will be disabled, so GEMS3K calculations shall be done 
only at (T,P) pair values given in the grid table (to be seen in the 
next wizard page) within tolerances given under P and T iterators. </p>
<p>




If different number of P and/or T points (greater than 1) was set by 
the user, the P and T values will be automatically generated using&nbsp;
 these given nP (nT), Min. and Step values from the iterators, again 
with the possibility for the user to modify values in the second page of
 this dialog, shown below:


</p>

<img style="width: 558px; height: 542px;" alt="SetupWritingGEMS3KfilesPage2grid.png" src="SetupWritingGEMS3KfilesPage2grid.png">
&nbsp; &nbsp; &nbsp; <br>
<p>




The "Next" button proceeds either to the next page (if "Enter pressure ..." checkbox is activated), or directly to the standard
dialog where the path to the folder where the generated input GEMS3K files will be saved. 



</p>
<p>
If the "Enter pressure ..." checkbox is activated and the "Disable 
Interpolation" checkbox is not activated, the second page will look like
 that shown below.&nbsp; In this example, the Pressure iterator on the 
first page has been set to 1 bar start, 91 bar end value, and 10 bar 
step; the Temperature iterator has been set to 5 C start, 95 C end 
value, and 5 degrees step. The user can now enter other numbers, if 
necessary, for instance, change pressure to 1; 10; 20; 30; ... bar; or 
some P and T values adjusted to allow more precise interpolation around 
some important phase transitions. The lookup grid will have 190 (T,P)
points, among which the interpolation in P,T space takes place.



</p>
<p>
If both the "Enter pressure ..." checkbox and the "Disable 
Interpolation" checkbox are activated, the second page for the previous 
example will take the following shape:</p>




<img style="width: 558px; height: 542px;" alt="SetupWritingGEMS3KfilesPage2pairs.png" src="SetupWritingGEMS3KfilesPage2pairs.png">&nbsp;<br>


<br>
<p>


In this case, the number of (T,P) pairs was determined from the 
Pressure iterator and applied to the whole interval given in the 
Temperature iterator, which yields 10 (T,P) pairs. The values can be 
edited now, if necessary, e.g. in accordance with experimental (T,P) 
data; the GEMS3K program will not perform interpolation, which means 
that only calculations at 10 given (T,P) pair values will be possible, 
as well as at slightly different T,P values within tolerances for each 
grid point. The look-up arrays will contain data for 10 (T,P) pair 
values, not for 100 (T,P) points as it would be in the case when the
interpolation is allowed.</p>





<h4>How to read GEMS3K I/O files with standalone calculation results
into a SysEq record <br>
</h4>
<p>


When GEMS3K input files have been exported from GEM-Selektor for use 
standalone coupled-code calculations that produce DBR files with 
different composition and speciation, such files can be imported into 
GEM-Selektor to investigate these results in "Single System" dialog and 
related EqDemo: and Multi: submodule windows. The files can be imported 
(read in) only in that modeling project where they have been originally 
exported from. 



</p>
<p>
To import GEMS3K files, arrange them in any folder in the same way as
 if they would be exported: one IPM, one DCH and one DBR file, with file
 names listed in the respective .lst file. For example, the initial 
GEMS3K files were exported from the SysEq record 
"Carbonates:G:IsoCaCdDol:0:0:10:75:0:" into a file set consisting of 
files&nbsp; "IsoCaCdDol-ipm.dat", "IsoCaCdDol-dch.dat", 
"IsoCaCdDol-dbr-0-0000.dat", and "IsoCaCdDol-dat.lst". The latter file 
lists the previous three files as


</p>

<p><tt>-t "IsoCaCdDol-dch.dat" "IsoCaCdDol-ipm.dat"&nbsp;
"IsoCaCdDol-dbr-0-0000.dat"</tt>


</p>
<p>
(this means that all four files must be in the same folder; -t tells 
that the files are in text format). The key of the exported SysEq record
 can be found at the beginning of the "IsoCaCdDol-ipm.dat" file. In 
standalone calculations, the DCH and IPM files will not be changed, only
 the new DBR files will be generated. To import one of those (e.g. 
"IsoCaCdDol-dbr-result-00001.dat"), it has to be placed in the same 
folder where DCH and IPM files reside, and its name must be entered into
 the .lst file, for instance, called "IsoCaCdDol-dat-to-import.lst" with
 contents




</p>

<p><tt>-t "IsoCaCdDol-dch.dat" "IsoCaCdDol-ipm.dat"&nbsp;
"IsoCaCdDol-dbr-0-0000-result.dat"</tt> </p>
<p>


When a folder with the set of GEMS3K files is ready, proceed as 
follows. Start GEM-Selektor and go in "Equilibria Calculation" mode, 
select and open the appropriate project ("Carbonates" in this 
example).&nbsp; In "Single System" dialog, execute the "Data" "Import 
GEMS3K DBR file..." menu command. </p>
<p>




In the appearing "Browse for GEMS3K *.lst file to import" dialog, 
find in the folder and select the necessary .lst file 
("IsoCaCdDol-dat-to-import.lst" in this example), and click 
"Open". You should see now the "Enter record key" dialog with fields 
corresponding to SysEq record key from the imported IPM file. Edit 
fields as you like, to make sure that no such SysEq record already 
exists in the project, and click Ok. The program reads GEMS3K files, and
 replaces the previous recipe by the bulk composition from DBR file 
taken over into the bi_ data object (input mole amounts of Independent 
Components),&nbsp; as well as metastability constraints and selection of
 components from the imported IPM and DCH files. &nbsp; &nbsp;&nbsp; 



</p>
<p>
In the appearing "Input Recipe" dialog, you should see now the bulk 
system composition from the imported DBR file, given as bi_ values. 
Click "Ok" to proceed.&nbsp; Now, click "Open EqDemo window..." toolbar 
button to explore the imported contents of the GEM task data structure 
just as they were computed by the standalone program, without being 
re-calculated in GEM-Selektor. You can save the SysEq record with these 
imported contents.


</p>
<p>
You can also re-calculate the imported equilibrium state to see if 
there is any difference, e.g. by differences in interpolated and
directly calculated thermodynamic data. These differences (if any) can 
be seen in the gEx column in MTparm (Thermodynamic data) window. To 
re-calculate, it is the best to clone the imported SysEq record and 
re-run GEM, then the data from originally imported and re-computed 
equilibria can be copy-pasted to a spreadsheet and compared there.


</p>
<h3>How to Export Many Initial Systems to GEMS3K I/O Files from GEM2MT
Module</h3>


&lt;under construction&gt;<br>


<br>


<br>


<hr size="2" width="100%">
<h2><a name="TAG_GEMIPM2K"></a>3. GEMS3K &#8211; a standalone GEM solver with
data exchange interface<br>
</h2>
<p>


The GEM IPM-3 algorithm described in <a href="#TAG_GEMIPM2">Section 2</a>
 is implemented in a TMulti C++ class. This class and related source 
code files are shared between the GEM-Selektor package (i.w. with GUI, 
database management system, script interpreter and
runtime help system) and a standalone solver GEMS3K code. The difference
 between two programs is controlled by a compiler define key&nbsp; <tt>-DGEMIPMPLUGIN</tt>  which has to be provided in the make- or project file for building any program that uses standalone GEMS3K. The global&nbsp; <tt>#define GEMIPMPLUGIN</tt>&nbsp;
 in the source code cuts any connection to the GEM-Selektor GUI, its 
data object descriptors, and data base functions. This is done because 
the main idea behind GEMS3K is to provide the same GEM chemical solver 
as that used in GEM-Selektor for easy coupling with existing 
fluid-mass-transport codes in the
&#8220;operator-splitting&#8221; fashion, also capable for high-performance 
computing.&nbsp; 


</p>
<p>
Because GEMS3K implemented as a &#8220;node-gem&#8221; example has no overhead on
 calling GUI or database functions, it provides a good opportunity to 
test performance of GEM IPM-3 module in terms of calculation times, as 
well as to locate parts of the code where most of the time is spent. The
 GEMS3K is a program arranged in three C++ classes: <tt>TMulti, TNode</tt> and <tt>TNodeArray</tt>.



</p>
<p>
The T<tt>Multi</tt> class is based on the <tt>MULTI</tt> data structure combined with all functions in which the GEM IPM-3 algorithm
is implemented. <tt>TMulti</tt> class also contains functions that 
connect it with the TSolMod class library of built-in models of mixing 
in multi-component phases. A practically important part is a collection 
of numerical controls that define the convergence and accuracy of GEM 
IPM-3 algorithm. Description of these controls is provided in the <a href="gems3k-ipm.html">gems3k_ipm.html</a> file;
they all can be changed also in the IPM input file of GEMS3K, as described in <a href="gems3k-iofiles.html">gems3k-iofiles.html</a> file. The work data structure <tt>MULTI</tt> of the <tt>TMulti</tt> class contains parameters and coefficients used by the built-in non-ideal mixing models in phases-solutions implemented in the <tt>TSolMod</tt> class (documentation about input parameters in the IPM file is given in <a href="gems3k-tsolmod.html">gems3k_tsolmod.html</a> file). 


</p>
<p>
The <tt>TNode</tt> class provides a simple non-GUI interface for 
loading the input chemical system definition and related thermodynamic 
and composition data into the IPM (<tt>MULTI</tt>) work structure, then 
running the IPM-3 algorithm for one calculation of equilibrium state, 
and extracting the calculated speciation into the <tt>DATABR</tt> structure (or DBR file). Description of <tt>TNode</tt> functions is provided in <a href="gems3k-useref.html">gems3k-useref.html</a> file.


</p>
<p>
The <tt>TNodeArray</tt> class, built on top of the <tt>TNode</tt> 
class, can store both chemical and transport parameters for all nodes of
 the mass transport problem. Re-calculation of equilibrium states after 
the mass transport step can be done with a single call
(with internal parallelization possible). This may be suitable for 
developing a new transport code. Description of <tt>TNodeArray</tt> functions will be provided in a separate document. 


</p>
<p>
TNode class uses two data interface structures &#8211; <tt>DATACH</tt> and <tt>DATABR</tt> (defined in <tt>datach.h</tt> and <tt>databr.h</tt> headers, respectively). The structures can be allocated in computer RAM (one instance of <tt>DATACH</tt> and one or more instances of <tt>DATABR</tt> per a GEMS3K instance) and written to or read from text or binary files (DCH and DBR format, respectively). In addition, the
IPM-3 specific data and arrays used by TSolMod I/O functions can be read from the IPM format file directly into the <tt>MULTI</tt>
structure. As the <tt>TNode</tt> class (with certain extensions) is also part of the GEM-Selektor package, all three files can be
produced per mouse click from there and then used in standalone coupled code calculations (see <a href="#TAG_MAKE_FILES">Section 2.4</a>).


</p>
<p>
The GEMS3K program source code comprises a sub-set of C++ source code
 files used in the GEM-Selektor v.3 code. In GEMS3K, some numerical 
subroutines from the<small> <big><a href="http://math.nist.gov/tnt/download.html">NIST JAMA-C++ TNT package</a></big></small> for solving SLE are employed. The list of source code files common to both GEM-Selektor and GEMS3K programs is provided below.</p>




<span style="font-family: Helvetica,Arial,sans-serif;"></span>
<h3><a name="TAG_SOURCE_FILELIST"></a>Lists of GEMS3K source code
files </h3>






<table border="1" cellpadding="2" cellspacing="2" width="100%">



  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <p>File name</p>
      </td>
      <td style="vertical-align: top;">
      <p>Comment</p>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">array.h</td>
      <td style="vertical-align: top;">Header and templates for
manipulating data arrays <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;"><b><small><big>databr.h</big></small></b></td>
      <td style="vertical-align: top;">Header for the DATABR
input/output data exchange structure of GEMS3K<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;"><b><small><big>datach.h</big></small></b></td>
      <td style="vertical-align: top;">Header for the DATACH input
chemical system definition structure of GEMS3K</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">gdatastream.cpp</td>
      <td style="vertical-align: top;">Implementation of file I/O
streams (with account for endianness in binary data files)<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">gdatastream.h</td>
      <td style="vertical-align: top;">Header for I/O streams for
file access <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">io_arrays.cpp</td>
      <td style="vertical-align: top;">Implementation of file I/O of
data arrays <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">io_arrays.h</td>
      <td style="vertical-align: top;">Header for the file I/O data
arrays functionality <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ipm_chemical.cpp</td>
      <td style="vertical-align: top;">Implementation of
chemistry-specific functions from TMulti class used in the GEM IPM
kernel<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ipm_chemical2.cpp</td>
      <td style="vertical-align: top;">Implementation of
chemistry-specific functions from TMulti class used in the GEM IPM
kernel </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ipm_chemical3.cpp</td>
      <td style="vertical-align: top;">Calculation of activity
coefficients and respective corrections to chemical potentials in GEM
IPM <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ipm_main.cpp</td>
      <td style="vertical-align: top;">Implementation of main GEM IPM
descent algorithm <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ipm_simplex.cpp</td>
      <td style="vertical-align: top;">Implementation of LP
calculations of automatic initial approximation using the modified
simplex method<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">jama_cholesky.h</td>
      <td style="vertical-align: top;">File from the NIST TNT
JAMA-C++ linear algebra numerical library<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">jama_lu.h</td>
      <td style="vertical-align: top;">File from the NIST TNT
JAMA-C++ linear algebra numerical library</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"><b><small><big>ms_multi.h</big></small></b></td>
      <td style="vertical-align: top;">Main header for the TMulti
class and MULTI data structure keeping data of GEM IPM-2 algorithm<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ms_multi_file.cpp</td>
      <td style="vertical-align: top;">Implementation of GEMS3K
file output (text dump file with TMulti data)<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">ms_multi_format.cpp</td>
      <td style="vertical-align: top;">Implementation of GEMS3K
file I/O (text and binary IPM files)</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">node.cpp</td>
      <td style="vertical-align: top;">Implementation of GEMS3K
TNode class - data exchange interface for coupled codes<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;"><small><big>node.h</big></small></td>
      <td style="vertical-align: top;">Header for the TNode class
(used in GEMS3K and in GEM2MT module of GEMS-PSI)<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">node_format.cpp</td>
      <td style="vertical-align: top;">Implementation of GEMS3K
file I/O (text and binary DCH and DBR files)</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">nodearray.cpp</td>
      <td style="vertical-align: top;">Implementation of GEMS3K
TNodeArray class - data exchange interface for coupled codes</td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;"><small><big>nodearray.h</big></small></td>
      <td style="vertical-align: top;">Header for the TNodeArray
class (used in GEMS3K and in GEM2MT module of GEMS-PSI)</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">num_methods.cpp</td>
      <td style="vertical-align: top;">Implementation of the internal
numerical&nbsp; solvers used in GEM IPM module <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">num_methods.h</td>
      <td style="vertical-align: top;">Headers for internal 1-D and
2-D Lagrange interpolation function (used in TNode)<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">s_solmod.h</td>
      <td style="vertical-align: top;">Definitions of the TSolMod class for built-in models of mixing in multicomponent phases </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">s_solmod.cpp</td>
      <td style="vertical-align: top;">

Implementation of the TSolMod base class </td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">s_solmod2.cpp</td>
      <td style="vertical-align: top;">Implementation of TSolMod derived classes for fluid phase models
(TPRSVcalc, TCGFcalc, TSRKcalc, TPR78calc, TCORKcalc and TSTPcalc)</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">s_solmod3.cpp</td>
      <td style="vertical-align: top;">

Implementation of TSolMod derived classes for 
activity models of mixing in condensed (solid and liquid) phases 
(TVanLaar, TRegular, TRedlichKister, TNRTL, TWilson, TMargulesTernary,
TMargulesBinary, TGuggenheim, TIdeal multi-site, TBerman)
  
</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">s_solmod4.cpp</td>
      <td style="vertical-align: top;">

Implementation of TSolMod derived classes for 
ion-association aqueous activity models (THelgeson, TDavies, 
TLimitingLaw, TDebyeHueckel, TKarpov, TShvarov)<br>
</td>
    </tr>
    <tr>
    <td valign="top"><tt>s_solmod5.cpp</tt></td>
    <td valign="top">Implementation of TSolMod derived classes for specific ion interaction aqueous activity models (TSIT, TPitzer, TEUNIQUAC)
      
</td>
  </tr>
  <tr>
    <td valign="top"><tt>s_solmod6.cpp</tt></td>
    <td valign="top">Stub file for implementation of TModOther derived class of TSolMod
      
</td>
  </tr>
<tr>
      <td style="font-family: monospace;">tnt.h</td>
      <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">tnt_array1d.h</td>
      <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">tnt_array2d.h</td>
      <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">tnt_i_refvec.h</td>
      <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">v_user.h</td>
      <td style="vertical-align: top;">Header containing declarations
of platform-specific utility functions and classes<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">verror.h</td>
      <td style="vertical-align: top;">Declarations for error
exceptions handling: classes TError and TFatalError<br>
      </td>
    </tr>
  </tbody>
</table>
<p>



The files are located in the "<tt>standalone/GEMS3K/</tt>" folder. 
Header files necessary for compiling or linking GEMS3K with the 
mass-transport part of the coupled code are shown in boldface. 


</p>
<p>
The following two header files from the GEMS3K folder have the same 
names as those used in the GEM-Selektor source code, but different 
contents. 


</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td style="font-family: monospace;">m_const.h</td>
      <td style="vertical-align: top;">Codes and parameters for
components and phases used in GEM IPM-3 work structure (standalone
version)<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">m_param.h</td>
      <td style="vertical-align: top;">Basic codes and numerical
settings used in GEM IPM-3 operation (standalone version)<br>
      </td>
    </tr>
  </tbody>
</table>
<p>





The following files: 



</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td style="font-family: monospace;">ms_param.cpp<small><a href="../../ms_param.cpp"><big> <br>
      </big></a></small></td>
      <td style="vertical-align: top;">Default values of constants
and numerical settings of GEM IPM-3 algorithm; implementations of
methods that load data into/from&nbsp; MULTI structure and start a
single GEM IPM-3 calculation<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">main.cpp</td>
      <td style="vertical-align: top;">Examples of using GEMS3K for
batch calculations of chemical equilibria (located in "<tt>gemcalc\</tt>"
and "<tt>node-gem\</tt>" folders) <br>
      </td>
    </tr>
  </tbody>
</table>
<p>


are also provided in the GEMS3K code. The files named "main.cpp" and 
"main.h" are needed for compiling an example of usage of GEMS3K. This 
file can be changed according to your tasks. 



</p>
<p>
The GEM IPM-3 algorithm is implemented as a set of C++ functions belonging to the <tt>TMulti</tt> class that all use data and lists provided in a single instance of the <tt>MULTI</tt> data structure also inserted into the <tt>TMulti</tt>
 class. Before any GEM calculation, all data arrays must be allocated 
according to current number of components and phases, and all input data
 must be correctly filled into these arrays. <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>




<span style="font-family: Helvetica,Arial,sans-serif;">
</span>
<p>In the GEM-Selektor GUI environment, this is done automatically 
before any GEM calculation is started. The data of the "internal" GEM 
problem are compressed into the <tt>MULTI</tt> data structure by 
collecting the items from the project system lists and arrays, as well 
as from the thermodynamic data base. In the project system lists, many 
independent components, dependent components, and phases may be switched
 off by the user. Only the names and data for components and phases that
 are switched on are copied into the <tt>MULTI</tt><span style="font-family: Helvetica,Arial,sans-serif;"> </span>structure. If 
necessary, the scripts for calculating activity coefficients of 
components of non-ideal solution phases are also compressed, together 
with any needed coefficients for non-ideal interaction parameters or 
surface complexation models picked up from the Phase database records. 
This makes the GEM-Selektor GUI setup of thermodynamic models very 
flexible, though rendering its software implementation more complicated



<span style="font-family: Helvetica,Arial,sans-serif;"></span><br>
</p>




<span style="font-family: Helvetica,Arial,sans-serif;">
</span>
<p>This route cannot be followed in the standalone GEMS3K program and 
any programs using it. The purpose of GEMS3K development was to keep the
 code implementation and handling of I/O data as simple as possible. 
This is the prerequisite for compiling the coupled FMT-GEM program on 
any computer architecture, up to parallel HPC clusters. Consequently, 
the GEMS3K
program has no GUI, no direct access to thermodynamic data base, and it 
has no script interpreter included. It uses only pre-loaded data for a 
"compressed" GEM problem thoroughly contained in the <tt>MULTI </tt>structure
 (i.e. no components or phases that were switched off from the lists are
 allowed). Because of that, some restrictions apply in GEMS3K compared 
to the GEM-Selektor code</p>
<span style="font-family: Helvetica,Arial,sans-serif;">
  </span>

<h4><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp;</span>DIfferences
in functionality between GEMS3K program and the complete GEM-Selektor
code<span style="font-family: Helvetica,Arial,sans-serif;"><br>
</span></h4>


<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td style="vertical-align: top;"><big>Functionality </big></td>
      <td style="vertical-align: top;"><big>GEMS3K </big></td>
      <td style="vertical-align: top;"><big>GEM-Selektor </big></td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Phase-
and Process math scripts </td>
      <td style="vertical-align: top;">Not
possible </td>
      <td style="vertical-align: top;">Used </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Built-in
functions for
activity coefficients </td>
      <td style="vertical-align: top;">Used </td>
      <td style="vertical-align: top;">Used </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">T-P
corrections for input
thermodynamic data </td>
      <td style="vertical-align: top;">Interpolation
using a lookup array (produced in GEM-Selektor) </td>
      <td style="vertical-align: top;">Direct
access to thermodynamic
data base, built-in HKF EoS, Cp double integration,
etc. </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Access
to input, output and
work data </td>
      <td style="vertical-align: top;">Batch
mode only (data exchange I/O files or
in RAM) </td>
      <td style="vertical-align: top;">Direct
GUI access, including
multithread stepwise mode </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Runtime
help and tooltips </td>
      <td style="vertical-align: top;">Not
available </td>
      <td style="vertical-align: top;">Available
as runtime HTML
help window and database </td>
    </tr>
  </tbody>
</table>


<br>


<p><span style="font-family: Helvetica,Arial,sans-serif;"></span>All the
 input data required for GEM IPM-3 calculation can be provided in a 
human-readable ASCII file. However, producing such a file without a 
software front-end that can access the thermodynamic data base would be a
 rather difficult and error-prone process. 


</p>
<p>
Moreover, reactive transport problems are usually represented by many
 nodes; reactive subsystems in all these nodes can share the same 
chemical system definition (CSD) and would usually differ only in bulk 
chemical composition (, temperature and pressure). Hence, it would make 
no sense to use the<tt> MULTI</tt> data structure directly for data 
exchange with the mass-transport part. Often, not all independent and 
dependent components must take place in exchange with the mass transport
 part - only those components
that are somehow transported from node to node. 



</p>
<p>
For these reasons, the whole content of the <tt>MULTI</tt> and <tt>BASE_PARAM</tt>
 data structures required for a GEMS3K calculation has been subdivided 
into three main parts, or data sub-sets (covered with the respective I/O
 files): <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>
<p><span style="font-family: Helvetica,Arial,sans-serif;">
</span></p>



<p><span style="font-family: Helvetica,Arial,sans-serif;"></span></p>


<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td style="vertical-align: top;">&nbsp;Identifier
of data subset<br>
      </td>
      <td style="vertical-align: top;">&nbsp;Data
structure<br>
      </td>
      <td style="vertical-align: top;">&nbsp;Visibility <br>
      </td>
      <td style="vertical-align: top;"><a href="#INPUT_FILES">&nbsp;I/O
file</a><br>
      </td>
      <td style="vertical-align: top;">&nbsp;Comment<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">DCH<br>
      </td>
      <td style="vertical-align: top;"><a href="../../datach.h">DATACH</a><br>
      </td>
      <td style="vertical-align: top;">GEM and MT parts<br>
      </td>
      <td style="vertical-align: top;">*DCH .dat<br>
      </td>
      <td style="vertical-align: top;">Input definition of the
chemical system (compressed) with selection of components and phases to
be exchanged with the mass-transport part common to all nodes of the
reactive transport problem<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">DBR<br>
      </td>
      <td style="vertical-align: top;"><a href="../../databr.h">DATABR</a><br>
      </td>
      <td style="vertical-align: top;">GEM and MT parts<br>
      </td>
      <td style="vertical-align: top;">*DBR .dat <br>
      </td>
      <td style="vertical-align: top;">Data bridge for node-specific
chemical input and output properties (bulk composition, speciation,
temperature, pressure, optional kinetic constraints)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">IPM<br>
      </td>
      <td style="vertical-align: top;"><a href="../../ms_multi.h">MULTI</a>,
      <a href="../../m_param.h">BASE_PARAM</a><br>
      </td>
      <td style="vertical-align: top;">GEM part only<br>
      </td>
      <td style="vertical-align: top;">*IPM .dat <br>
      </td>
      <td style="vertical-align: top;">Input information not relevant
for the tarnsport part of the code, but needed for GEM IPM-3
calculations (numerical
settings, parameters of non-ideal mixing models, adsorption models
etc.) <br>
      </td>
    </tr>
  </tbody>
</table>
<p>


Upon reading/writing, DCH and DBR files are automatically (un)packed to/from the <tt>MULTI</tt> memory structure inside of the <tt>TNode</tt> class instance. 




The advantage of having three kinds of input files instead of one is 
that in a typical reactive transport problem with tens to hundreds of 
thousands of nodes, only one relatively large DCH and one IPM file is 
needed, while node-specific data are provided in many small and compact 
input-output DBR files which do not contain redundant information. As a 
consequence,  higher
performance and flexibility of the coupled code can be achieved. 



<br>
</p>
<p>
In the current implementation of GEMS3K, two file I/O modes are 
possible: binary stream and text stream. Binary stream DCH, DBR and IPM 
files are simply images of the respective memory data structures; they 
may be non-transferable between different computer architectures. The 
text stream files are transferable; they have a human-readable format 
with tags (keywords) followed with the data; comment lines are possible 
almost anywhere. For most data items, the input order is free; many data
 objects can be
skipped if the program can substitute default values.&nbsp; Only  
dimenions necessary for internal data allocation must be present at the
beginning of DCH and IPM files. More about the file formats and 
structure of GEMS3K is provided in the <a href="gems3k-iofiles.html">companion manual</a>.</p>




<br style="font-family: Helvetica,Arial,sans-serif;">


<hr size="2" width="100%">
<h3><a name="TAG_DATACH"></a>3.1. DATACH data exchange structure for
sharing chemical
system definition (CSD)<font style="font-family: times new roman,times,serif;" face="Helvetica, Arial, sans-serif">&nbsp;</font> </h3>
<p>


The DATACH structure in datach.h file (mirrored in a DCH input file) 
contains an input definition of the chemical system visible to both 
GEMS3K and mass-transport parts of a coupled code. The respective 
dimensions, lists of components and phases etc. will be automatically 
copied into the <tt>MULTI </tt>work data structure of <tt>TMulti</tt> class upon an initialization of a&nbsp; <tt>TNode</tt> class instance, which includes reading of one DCH, one IPM and at least one DBR file. 


</p>
<p>
The<span style="font-weight: bold;"> </span>Chemical System Definition part of the DATACH structure includes the following data: 


</p>
<table style="width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td>Type</td>
      <td> ID in
DATACH structure<br>
      </td>
      <td> ID in
MULTI structure<br>
      </td>
      <td> DOD label
in GEMS</td>
      <td style="vertical-align: top;">Tag in DCH file<br>
      </td>
      <td> Content</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">long int<br>
      </span></td>
      <td style="font-family: monospace;"> nIC</td>
      <td style="font-family: monospace;"> N<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">nIC<br>
      </td>
      <td> Total
number of IC (independent components) <br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> </span><span style="font-family: monospace;">long int</span><br>
      </td>
      <td style="font-family: monospace;"> nDC</td>
      <td style="font-family: monospace;"> L<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">nDC<br>
      </td>
      <td> Total
number of DC (chemical species or dependent components) <br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> </span><span style="font-family: monospace;">long int</span><br>
      </td>
      <td style="font-family: monospace;"> nPH</td>
      <td style="font-family: monospace;"> FI<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">nPH<br>
      </td>
      <td> Total
number of phases included into this CSD</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> </span><span style="font-family: monospace;">long int</span><br>
      </td>
      <td style="font-family: monospace;"> nPS</td>
      <td style="font-family: monospace;"> FIs<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">nPS<br>
      </td>
      <td> Number of
multicomponent phases (nPS &lt;=&nbsp; nPH)</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> </span><span style="font-family: monospace;">long int</span><br>
      </td>
      <td style="font-family: monospace;"> nDCs</td>
      <td style="font-family: monospace;"> Ls<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">nDCs<br>
      </td>
      <td> Total
Number of DC in phases-solutions</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">short</span><span style="font-family: monospace;">[]</span></td>
      <td style="font-family: monospace;"> nDCinPH</td>
      <td style="font-family: monospace;"> L1<br>
      </td>
      <td style="font-family: monospace;"> L1<br>
      </td>
      <td style="font-family: monospace;">nDCinPH<br>
      </td>
      <td> Number of
DC included into each phase [nPH] </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">double[]</span></td>
      <td style="font-family: monospace;"> A</td>
      <td style="font-family: monospace;"> A<br>
      </td>
      <td style="font-family: monospace;"> A<br>
      </td>
      <td style="font-family: monospace;">A</td>
      <td>Stoichiometry
matrix A containing amounts of IC in one mole of each DC
[nIC][nDC]<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">double</span><span style="font-family: monospace;">[]</span></td>
      <td style="font-family: monospace;"> ICmm</td>
      <td style="font-family: monospace;"> Awt<br>
      </td>
      <td style="font-family: monospace;"> icM<br>
      </td>
      <td style="font-family: monospace;">ICmm<br>
      </td>
      <td> IC atomic
(molar) mass in g/mol [nIC]<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">double</span><span style="font-family: monospace;">[]</span></td>
      <td style="font-family: monospace;"> DCmm</td>
      <td style="font-family: monospace;"> MM<br>
      </td>
      <td style="font-family: monospace;"> mmDC<br>
      </td>
      <td style="font-family: monospace;">DCmm *<br>
      </td>
      <td> DC molar
mass in g/mol [nDC]<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">char*[]</span></td>
      <td style="font-family: monospace;"> ICNL</td>
      <td style="font-family: monospace;"> SB<br>
      </td>
      <td style="font-family: monospace;"> ICnam<br>
      </td>
      <td style="font-family: monospace;">ICNL<br>
      </td>
      <td> List of
IC names, [nIC] strings of MaxICN
length</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">char*[]</span></td>
      <td style="font-family: monospace;"> DCNL</td>
      <td style="font-family: monospace;"> SM<br>
      </td>
      <td style="font-family: monospace;"> DCnam<br>
      </td>
      <td style="font-family: monospace;">DCNL<br>
      </td>
      <td> List of
DC names, [nDC] strings of MaxDCN
length</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">char*[]</span></td>
      <td style="font-family: monospace;"> PHNL</td>
      <td style="font-family: monospace;"> SF<br>
      </td>
      <td style="font-family: monospace;"> PHnam<br>
      </td>
      <td style="font-family: monospace;">PHNL<br>
      </td>
      <td> List of
names of phases, [nPH] strings of
MaxPHN length</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">char[]</span></td>
      <td style="font-family: monospace;"> ccIC</td>
      <td style="font-family: monospace;"> ICC<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">ccIC<br>
      </td>
      <td> Class
codes of IC [nIC], see codes in enum ICL_CLASSES<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">char[]</span></td>
      <td style="font-family: monospace;"> ccDC</td>
      <td style="font-family: monospace;"> DCC<br>
      </td>
      <td style="font-family: monospace;"> DCC<br>
      </td>
      <td style="font-family: monospace;">ccDC<br>
      </td>
      <td> Class
codes of DC [nDC], see codes in enum DCL_CLASSES<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;">char[]</span></td>
      <td style="font-family: monospace;"> ccPH</td>
      <td style="font-family: monospace;"> PHC<br>
      </td>
      <td style="font-family: monospace;"> <br>
      </td>
      <td style="font-family: monospace;">ccPH<br>
      </td>
      <td> Class
codes of phases [nPH], see codes in enum PHL_CLASSES <br>
      </td>
    </tr>
  </tbody>
</table>


<p>* <tt>DCmm</tt> vector is automatically calculated from <tt>A</tt> and <tt>ICmm</tt> data and can be skipped from the DCH file</p>
<p>

Because direct access to GEMS thermodynamic data base is not possible and functions for <i>T,P</i>
 corrections of thermodynamic
data&nbsp; are not available in GEMS3K, the retrieval of thermodynamic 
data for dependent components is implemented through the Lagrange 
interpolation from look-up arrays provided in the <tt>DATACH</tt> 
structure and DCH file.These look-up arrays are automatically generated 
in in GEM-Selektor package and written into the DCH file. To use the 
lookup arrays, the <tt>TNode</tt> class employs a 2-D
Lagrange interpolation routine that extracts thermodynamic data for 
temperature and pressure of interest and loads them into the <tt>MULTI</tt> structure before starting the IPM-3 calculation. In this way, the coupled models where temperature and/or pressure change
over time or between the nodes can be easily implemented without blowing up the GEMS3K size and complexity. &nbsp;



</p>
<p>
The<span style="font-weight: bold;"></span> DATACH structure includes the following objects related to thermodynamic data: 


</p>
<table style="width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td>Type</td>
      <td> ID</td>
      <td> Dimensions</td>
      <td> Comment</td>
      <td style="vertical-align: top;">Tag in DCH file </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nTp</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Number of temperature points in lookup grid arrays<br>
      </td>
      <td style="font-family: monospace;">nTp<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nPp</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Number of pressure points in lookup grid arrays <br>
      </td>
      <td style="font-family: monospace;">nPp<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> iGrd</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Flag for lookup grid array setup: 0 - only V0 and G0; 1
- plus H0; 2 - plus S0; 3 - plus Cp0; 4 - plus A0 (Helmholtz); -1 - V0,
G0 and DD (modes 1,2,3,4,-1 reserved)</td>
      <td style="font-family: monospace;">iGrd<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]</td>
      <td style="font-family: monospace;"> TKval</td>
      <td style="font-family: monospace;"> nTp</td>
      <td>[nTp] discrete values of temperature <span style="font-style: italic;">T</span>, in K,&nbsp; in ascending order<br>
      </td>
      <td style="font-family: monospace;">TKval<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]</td>
      <td style="font-family: monospace;"> Pval</td>
      <td style="font-family: monospace;"> nPp</td>
      <td>[nPp] discrete values of pressure <span style="font-style: italic;">P</span>, in Pa (1 bar = 1e5 Pa)&nbsp; in
ascending order<br>
      </td>
      <td style="font-family: monospace;">Pval<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double</td>
      <td style="font-family: monospace;"> Ttol</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Temperature tolerance, in K, for the interpolation of
thermodynamic data (default: 0.1)<br>
      </td>
      <td style="font-family: monospace;">Ttol<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double</td>
      <td style="font-family: monospace;"> Ptol</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Pressure tolerance, in Pa, for the interpolation of
thermodynamic data (default: 1000)<br>
      </td>
      <td style="font-family: monospace;">Ptol<br>
      </td>
    </tr>
  </tbody>
</table>


<br>
<p>


The following lookup arrays of thermodynamic data can be allocated in <tt>DATACH</tt> (G0 and V0 are mandatory):&nbsp; 



</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td>Type</td>
      <td> ID</td>
      <td>Dimensions</td>
      <td> comment</td>
      <td style="vertical-align: top;">Tag in DCH file<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace;"> roW</td>
      <td style="font-family: monospace;"> [nPp][nTp][5] </td>
      <td> Density of water-solvent, kg/m<sup>3</sup> and its T and P
derivatives<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">roW<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace;"> epsW</td>
      <td style="font-family: monospace;"> [nPp][nTp][5]</td>
      <td> Dielectric constant of water-solvent, with its T and P
derivatives<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">epsW<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">double[]</td>
      <td style="vertical-align: top;"><span style="font-family: monospace;">visW</span><small><br>
      </small></td>
      <td style="vertical-align: top; font-family: monospace;">[nPp][nTp][5]</td>
      <td style="vertical-align: top;">Viscosity of water-solvent, with
its T and P derivatives (units?)<br>
      </td>
      <td style="vertical-align: top;"><span style="font-family: monospace;">visW</span><small><br>
      </small></td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace; font-weight: bold;"> G0</td>
      <td style="font-family: monospace;"> [nDC][nPp][nTp] </td>
      <td><span style="font-weight: bold;"> G<sup>o</sup> standard
molar Gibbs
energy function of DC, J/mol, corrected to </span><span style="font-style: italic; font-weight: bold;">T,P</span><br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">G0<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace; font-weight: bold;"> V0</td>
      <td style="font-family: monospace;"> [nDC][nPp][nTp]</td>
      <td style="font-weight: bold;"> V<sup>o</sup> standard molar
volume of DC,
m3/mol, corrected to <span style="font-style: italic;">T,P</span></td>
      <td style="vertical-align: top; font-family: monospace;">V0<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace;"> S0</td>
      <td style="font-family: monospace;"> [nDC][nPp][nTp]</td>
      <td>S<sup>o</sup> standard molar entropy of DC, J/K/mol,
corrected to <span style="font-style: italic;">T,P</span> <br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">S0<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace;"> H0</td>
      <td style="font-family: monospace;"> [nDC][nPp][nTp]</td>
      <td> H<sup>o</sup> standard molar enthalpy function of DC, J/mol,
corrected
to <span style="font-style: italic;">T,P</span><br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">H0<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">double[]<br>
      </td>
      <td style="font-family: monospace;"> Cp0</td>
      <td style="font-family: monospace;"> [nDC][nPp][nTp] </td>
      <td> Cp<sup>o</sup> molar heat capacity of DC J/K/mol, corrected
to <span style="font-style: italic;">T,P</span> <br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">Cp0<br>
      </td>
    </tr>
  </tbody>
</table>


<p><b>Attention</b>: the <tt>S0, H0</tt> and <tt>Cp0</tt> arrays will be
 exported into DCH file only if the respective arrays in the modeling 
project chemical system are activated in GEM-Selektor. The <tt>roW, epsW</tt> and <tt>visW</tt> arrays will not be exported if the system is non-aqueous (i.e. there is no water-solvent and no aqueous phase).<br></p>



<p>The <big><span style="font-family: monospace;"><small>roW,epsW</small></span></big>  and <span style="font-family: monospace;">visW</span> lookup arrays are provided because they are used internally in <tt>TSolMod</tt> functions for calculation of activity coefficients of aqueous species and water. The <span style="font-family: monospace;">TNode</span> class provides direct methods for accessing interpolated thermodynamic data from the mass-transport part at any time (see <a href="gems3k-useref.html">User's Reference</a>). </p>
<p>


The trivial case of lookup is when <span style="font-family: monospace;">nTp</span><small> = 1</small> and <span style="font-family: monospace;">nPp</span><small> = 1</small>.
 In this case, each thermodynamic data lookup array (see the table 
above) must contain one value per DC for a single temperature <span style="font-family: monospace;">TKval[0]</span> and pressure<small> </small><span style="font-family: monospace;">Pval[0]</span>. Conversely, no variations in <span style="font-style: italic;">T,P</span> between the nodes or with time will then be allowed in the coupled model. Actually, the program checks that current <span style="font-style: italic;">T</span> and <span style="font-style: italic;">P</span> coincide with a value from <big><span style="font-family: monospace;"><small>TCval</small> </span></big>resp. <big><small><span style="font-family: monospace;">Pval</span></small><span style="font-family: monospace;"></span></big> within the tolerance limits given in <span style="font-family: monospace;"></span><span style="font-family: monospace;">Ttol</span> and <span style="font-family: monospace;">Ptol</span>, respectively, and picks up the values from grid arrays.&nbsp; 


</p>
<p>
The more common case is when the pressure is fixed (<span style="font-family: monospace;">nPp</span><small> = 1</small>), but the temperature in the nodes is allowed to change (e.g. <span style="font-family: monospace;">nTp</span><small>=
8</small>). Then the <span style="font-family: monospace;">Pval</span> array must contain a single value of pressure (e.g. 1 MPa) and the <span style="font-family: monospace;">TKval</span> array must contain 8 values of temperature in ascending order (e.g. 5, 25, 45, 65, 85, 105, 125, 145 <sup>o</sup>C). These values define the overall temperature interval
{4.9; 145.1 <sup>o</sup>C}. The differences between adjacent temperature values must not necessarily be equal. According to this setup, the <span style="font-family: monospace;">roW</span> and similar arrays must contain 8 values each that correspond to 1 MPa pressure and the temperatures given in <span style="font-family: monospace;">TKval</span>
array. Given that there are 40 dependent components in the DCH list, the <span style="font-family: monospace;">G0</span> array will consist of 8 values per DC, i.e. total 320 numbers, the first 8 contain <span style="font-style: italic;">G</span><sup>o</sup> values for the first species (for temperatures in <span style="font-family: monospace;">TKval</span>), next 8 values - for the second species, and so on. The <span style="font-family: monospace;">V0</span> and other arrays will be organized likewise. The interpolation subroutine looks then separately for each dependent
component to return <span style="font-style: italic;">G</span><sup>o</sup> and <span style="font-style: italic;">V</span><sup>o</sup> values for <span style="font-style: italic;">P</span>=10 bar and <span style="font-style: italic;">T</span> of interest, interpolated in 1-D mode, if necessary. 


</p>
<p>In the most general case, the lookup grid arrays contain numbers for 
several discrete pressures and several discrete temperatures. Then the <span style="font-family: monospace;">roW</span> and <span style="font-family: monospace;">epsW</span> arrays are actually&nbsp; tables made of rows each containing values for different temperatures from <span style="font-family: monospace;">TKval</span>
but one pressure value from <span style="font-family: monospace;">Pval</span>. The <big><span style="font-family: monospace;"><small>G0</small> </span></big>and <span style="font-family: monospace;">V0</span> arrays are then composed of such tables for each dependent component,
arranged in the order in which the dependent components are listed in the <tt>DATACH</tt> <span style="font-family: monospace;">DCNL</span> list. The interpolation subroutine performs 2-D interpolation separately for each dependent component to return its G<sup>o</sup> and V<sup>o</sup> values for <span style="font-style: italic;">P,T</span> of interest.  To achieve accurate interpolation over a wide temperature interval (300<sup> o</sup>C or more), at least 30 temperature points and 10 pressure points are recommended. 



</p>
<p>
There is a special 'pairwise' mode with equal number of pressure and temperature grid points <span style="font-family: monospace;">nTp</span><small> =</small> <span style="font-family: monospace;">nPp</span><small> </small>.
 In this mode, no interpolation is allowed, and only a T,P pair can be 
used in calculations that corresponds to one of the lookup grid points 
(within tolerances <small><tt><big>Ptol</big></tt><tt>, </tt><tt><big>Ttol</big></tt></small>). Accordingly, there will be <tt>nPp</tt> values in <tt>roW, epsW</tt> and <tt>visW</tt> arrays, and <tt>nDC*nPp</tt> values in <tt>G0, V0</tt>
and other thermodynamic data arrays. &nbsp; 



</p>
<p>
Thus, the lookup arrays of thermodynamic data permit GEMS3K to extract thermodynamic data for any current <span style="font-style: italic;">T</span> and <span style="font-style: italic;">P</span> in any node, provided that <span style="font-style: italic;">T</span> and <span style="font-style: italic;">P</span> are within the respective ranges set in <small><tt><big>TKval</big></tt></small> and <small><tt><big>Pval</big></tt></small> lists. Before calling the GEM IPM-3
calculation, the interpolation is performed, and <span style="font-style: italic;">G</span><sup>o</sup> and <span style="font-style: italic;">V</span><sup>o</sup> values are loaded directly into the MULTI structure, where they remain as long as the input <span style="font-style: italic;">P</span> and <span style="font-style: italic;">T</span> do not change. New interpolation is done when the requested <span style="font-style: italic;">P</span> or <span style="font-style: italic;">T</span> differ from previous values by
more than <small><tt><big>Ptol</big></tt><tt>, </tt><tt><big>Ttol</big></tt></small>.



</p>

<p><a name="INDEX_MAPPING"></a> A special part of the <tt>DATACH</tt> structure (and file) defines the selection of components and phases to be exchanged with the mass-transport program via the <tt>DATABR</tt> structure instances for nodes, or via the DBR files. This part includes the following data items: 


</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td>Type</td>
      <td> ID</td>
      <td>Dimensions</td>
      <td> Comment</td>
      <td style="vertical-align: top;">Tag
in DCH file<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nICb</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Number of IC (stoichiometry units) (&lt;= nIC) used in
DATABR<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">nICb<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nDCb</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Number of DC (chemical species) &lt;= nDC) used in DATABR<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">nDCb<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nPHb</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Number of Phases (&lt;= nPH) used in DATABR<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">nPHb<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nPSb</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Number of Phases-solutions (&lt;= nPS) used in DATABR<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">nPSb<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int<br>
      </td>
      <td style="font-family: monospace;"> nAalp</td>
      <td style="font-family: monospace;"> 1<br>
      </td>
      <td> Flag for considering surface areas of phases in DATABR<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">nAalp<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int[]</td>
      <td style="font-family: monospace;"> xIC</td>
      <td style="font-family: monospace;"> [nICb]</td>
      <td>index mapping list for ICs used in DATABR data vectors <br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">xIC<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int[]</td>
      <td style="font-family: monospace;"> xDC</td>
      <td style="font-family: monospace;"> [nDCb]</td>
      <td>index mapping list for DCs used in DATABR data vectors <br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">xDC<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">long int[]</td>
      <td style="font-family: monospace;"> xPH</td>
      <td style="font-family: monospace;"> [nPHb]</td>
      <td>index mapping list for phases used in DATABR data vectors <br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">xPH<br>
      </td>
    </tr>
  </tbody>
</table>


<br>
<p>
The trivial
(default) case is when <big> <small><span style="font-family: monospace;">nICb
= nIC,</span></small></big><span style="font-family: monospace;">nDCb =
nDC, </span><span style="font-family: monospace;">nPHb =
nPH, </span><big><span style="font-family: monospace;"><small>nPSb =
nPS.</small><span style="font-family: Helvetica,Arial,sans-serif;"></span></span></big>In
this
case, the data vectors in <tt>DATABR</tt> structure exactly map the
corresponding data vectors in<tt> DATACH</tt> and <tt>MULTI</tt>
structures. For
instance, the bulk chemical composition of the system - vecto<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;">r </span><small><span style="font-family: monospace;">b</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>in
<tt>MULTI</tt> structure -
is the
same as the vector<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span><small><span style="font-family: monospace;">bIC</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>provided
in the <tt>DATABR</tt> structure or DBR file. The index one-to-one
mapping lists<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span><small><span style="font-family: monospace;">xIC, xDC</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>and<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span><small><span style="font-family: monospace;">xPH</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>will
also be
trivial. For instance, given 7 independent components in the system<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> <small>(</small></span><small><span style="font-family: monospace;">nIC</span></small><span style="font-family: Helvetica,Arial,sans-serif;"><small> = 7)</small>,
</span></span></big>the<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span><small><span style="font-family: monospace;">xIC</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>array
will simply
contain ascending indexes<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> <small>(</small></span><small><span style="font-family: monospace;">0,1,2,3,4,5,6</span></small><span style="font-family: Helvetica,Arial,sans-serif;"><small>)</small>.</span></span></big>&nbsp;<br>
</p>
<p>However, the usage of
index mapping lists<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp; </span></span></big><big><span style="font-family: monospace;"><small><span style="font-family: monospace;">xIC,xDC</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>and<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span><small><span style="font-family: monospace;">xPH</span></small><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>may
significantly accelerate data exchange and reduce memory size of the
coupled RMT-GEM problem when some ICs, DCs and phases are not
considered in transport between the nodes. For example, the
break-through columns
in experiments are often filled with the quartz sand, dissolution of
which
can be neglected, so the transport of dissolved silica can also be
neglected.&nbsp; For a system involving calcium and magnesium,
carbonate, and chloride, the&nbsp; <tt>DATACH</tt> name lists may look
like:

</p>

<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>


<p style="font-family: Helvetica,Arial,sans-serif;"><big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span></big></p>


<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td style="vertical-align: top;"><big><span style="font-family: monospace;"><span style="font-family: monospace;"><br>
      <small>&lt;nIC&gt;
8&nbsp;&nbsp; &lt;nDC&gt; 27&nbsp;&nbsp; &lt;nPH&gt; 8&nbsp;&nbsp;
&lt;nPS&gt; 2<br>
&lt;ICNL&gt;</small></span><small><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp; </span><span style="font-family: monospace;">'C' 'Ca' 'Cl' 'H' 'Mg' 'O' <span style="color: rgb(204, 0, 0);">'Si'</span> <span style="color: rgb(204, 0, 0);">'Zz'</span></span><span style="font-family: Helvetica,Arial,sans-serif;"> &nbsp;&nbsp; ( NB: </span><span style="font-family: monospace;">'Zz'</span><span style="font-family: Helvetica,Arial,sans-serif;"> stays for electrical
charge). <br>
      </span><span style="font-family: monospace;">&lt;DCNL&gt;</span><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp; </span><span style="font-family: monospace;">'Ca+2' 'CaOH+' <span style="color: rgb(204, 0, 0);">'Ca(HSiO3)+'</span> <span style="color: rgb(204, 0, 0);">'CaSiO3@'</span> 'Mg+2' 'MgOH+' <span style="color: rgb(204, 0, 0);">'HSiO3-' 'SiO2@' 'SiO3-2'</span> 'CO2@'
'CO3-2' 'HCO3-' <span style="color: rgb(153, 51, 153);">'CH4@'</span>
'Cl-' 'H2@' 'O2@' 'OH-' 'H+' 'H2O@' <span style="color: rgb(204, 0, 0);">'H2' 'O2'</span> <span style="color: rgb(153, 51, 153);">'Gr'</span> 'Cal' 'Dis-Dol' <span style="color: rgb(153, 51, 153);">'Portlandite' 'Brc'</span> <span style="color: rgb(204, 0, 0);">'Qtz'</span></span><span style="font-family: Helvetica,Arial,sans-serif;">. <br>
      </span><span style="font-family: monospace;">&lt;PHNL&gt;</span><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp;</span><span style="font-family: monospace;"> 'aq_gen' <span style="color: rgb(204, 0, 0);">'gas_gen'</span> <span style="color: rgb(153, 51, 153);">'Graphite'</span> 'Calcite'
'Dolomite-dis' <span style="color: rgb(153, 51, 153);">'Portlandite'
'Brucite'</span><span style="color: rgb(204, 0, 0);"> 'Quartz'</span></span><span style="font-family: Helvetica,Arial,sans-serif;"><br>
      </span><span style="font-family: monospace;">&lt;nDCinPH&gt;</span><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp; </span></small><span style="font-family: monospace;"><small>19 2 1 1 1 1 1 1</small><br>
      <br>
      </span><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big></td>
    </tr>
  </tbody>
</table>


<br>
<p>


Now, suppose that our
mass transport model does not consider the transport of gas phase,
electric charge, and of dissolved silicium species (non-transported
components and species are marked red in the lists above). Some
aqueous species and solids are very unlikely to appear (marked in pink)
and thus
can also be considered irrelevant for the mass transport model.
Then&nbsp;
the&nbsp; respective arrays of the <tt>DATABR</tt> structure can be
made
smaller, and values in them re-mapped to <tt>DATACH</tt> or <tt>MULTI</tt>
structure as
follows: 

</p>

<big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"> </span></span></big>


<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td style="vertical-align: top;"><big><span style="font-family: monospace;"><span style="font-family: monospace;"><small>&lt;nICb&gt;
6 &nbsp; &lt;nDCb&gt; 15 &nbsp; &lt;nPHb&gt; 3 &nbsp; &lt;nPSb&gt; 1<br>
&lt;xIC&gt;&nbsp; 0 1 2 3 4 5 <br>
&lt;xDC&gt;&nbsp; 0 1&nbsp; 4 5&nbsp; 9 10 11&nbsp; 13 14 15 16 17
18&nbsp; 22 23 <br>
&lt;xPH&gt;&nbsp; 0&nbsp; 3 4</small> </span></span></big></td>
    </tr>
  </tbody>
</table>


<br>
<p>


It is important
to realize that the re-mapping does not affect any dimensions in the <tt>MULTI</tt>
structure and any <tt>DATACH</tt> lists and arrays (the latter remain
accessible in full also to the transport part of the coupled code).
Values for components and phases marked red (non-transported) are
skipped only from data arrays in all instances of the <tt>DATABR</tt>
structure,
but
these components and phases are still present in <tt>DATACH</tt> and <tt>MULTI</tt>
structures and take part in the equilibration. In the above example,
the size of a <tt>DATABR</tt> instance (and DBR file) becomes more
than 30% less
compared with the trivial (complete) index mapping case.&nbsp; This
decrease can be even more dramatic for some transport algorithms where
only a certain tracer moves, or where the advection strongly prevails
over the diffusion. In the latter case, only the bulk aqueous solution
is migrated as the whole between the nodes, so all dependent components
of the aqueous phase can be skipped from the <tt>DATABR</tt> mapping.
In the
above example, this would make the <tt>DATABR</tt> instance ca. 3-4
times
smaller
than in the trivial mapping case. <big><span style="font-family: monospace;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span></big></p>


<p>



The presence of DATABR index mapping to DATACH structure provides a
great flexibility in defining various coupling schemes between the RMT
and the GEM parts. A natural question is - how the bulk composition of
the node system can be set up when the mapping list xIC is
incomplete?&nbsp;
A straightforward answer: the full b vector can
always be
provided in the IPM file (from where it is directly loaded into the <tt>MULTI</tt>
structure). The <tt>TNode</tt> class also has
methods for the direct access to the b&nbsp; vector using
the <tt>DATACH/MULTI</tt> indexation, which can be used e.g. for
setting in all
nodes the initial amounts of ICs skipped from the <tt>DATABR</tt>
index mapping.
Use of this functionality makes sense in 2-D or 3-D RMT problems with
relatively large chemical system definition, where it may result in
considerably less memory demand and higher performance of data
exchange. However, the use of SIA initial approximation mode of GEM
IPM-3 may be restricted in this case. Hence, for 1-D columns, we
recommend
using the trivial (complete) one-to-one mapping in <tt>DATABR</tt>
structure and in DBR
files. </p>



<br>


<hr size="2" width="100%">
<p> </p>


<h3><a name="TAG_DATABR"></a>3.2. DATABR data exchange structure for
defining i/o data
for a single node system </h3>
<p>


This data
structure relies on dimensions provided in the <tt>DATACH</tt>
structure. Hence,
the DCH file must always be read before DBR file(s) in order to
initialize the <tt>MULTI</tt> and <tt>DATABR</tt> structures and
perform dynamic memory
allocation. 

</p>
<p>
The <tt>DATABR</tt>
structure contains several flags and three blocks of data. In the
following tables, four columns are provided to indicate which data
fields are set in <tt>DATABR</tt> by the mass transport part (MT-DB);
which are
given from <tt>DATABR</tt> instance to GEM as input data (DB-GEM);
which data is
taken from GEM to <tt>DATABR</tt> as GEM output (GEM-DB); and which
are taken
from <tt>DATABR</tt> instance to MT part data structures (DB-MT). The
most
important GEM input and output data are shown in boldface. <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>



<p>
1. Chemical
scalar variables (all double floating point numbers). Data for the
inert
sub-system are not included in GEM IPM-3 calculations and serve for
completeness of node-related information used by the MT part (mainly on
<tt>TNodeArray</tt> level). </p>



<span style="font-family: monospace;"></span><span style="font-family: monospace;"></span><span style="font-family: monospace;"></span>
<table style="width: 891px; height: 395px;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td>ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
      </td>
      <td> Comment</td>
      <td valign="top">Units<br>
      </td>
      <td style="vertical-align: top;">Default<br>
      </td>
      <td style="text-align: center;">MT-DB</td>
      <td style="text-align: center;">DB-GEM</td>
      <td style="text-align: center;">GEM-DB</td>
      <td style="text-align: center;">DB-MT</td>
      <td> Label in
DBR file</td>
    </tr>
    <tr>
      <td style="font-weight: bold;"><span style="font-family: monospace;">TK</span></td>
      <td> Temperature T<br>
      </td>
      <td valign="top">K<br>
      </td>
      <td style="vertical-align: top;">25<br>
      </td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace;">TK<br>
      </td>
    </tr>
    <tr>
      <td style="font-weight: bold;"><span style="font-family: monospace;"> P</span></td>
      <td> Pressure P<br>
      </td>
      <td valign="top">Pa<br>
      </td>
      <td style="vertical-align: top;">1<br>
      </td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace;">P<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> <b>Vs</b></span></td>
      <td> Volume V of reactive subsystem<br>
      </td>
      <td valign="top">m<sup>3</sup><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;">+</td>
      <td style="font-family: monospace; text-align: center;">(+)</td>
      <td style="font-family: monospace; text-align: center;">(+)</td>
      <td style="font-family: monospace; text-align: center;">+</td>
      <td style="font-family: monospace;">Vs<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> Vi</span></td>
      <td> Volume of the inert subsystem<br>
      </td>
      <td valign="top">m<sup>3</sup><br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">Vi<br>
      </td>
    </tr>
    <tr>
      <td style="font-weight: bold;"><span style="font-family: monospace;"> Ms</span></td>
      <td> Mass M of reactive subsystem<br>
      </td>
      <td valign="top">kg<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;">(+)</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace;">Ms<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> Mi</span></td>
      <td> Mass of the inert subsystem<br>
      </td>
      <td valign="top">kg<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">Mi<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> Gs</span></td>
      <td> Gibbs energy of reactive subsystem<br>
      </td>
      <td valign="top">J<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;">(+)</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">Gs<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> Hs</span></td>
      <td> Enthalpy of reactive subsystem (reserved)<br>
      </td>
      <td valign="top">J<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;">(+)</td>
      <td style="font-family: monospace; text-align: center;">+</td>
      <td style="font-family: monospace;">Hs<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> Hi</span></td>
      <td> Enthalpy of the inert subsystem<br>
      </td>
      <td valign="top">J<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">Hi<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> IC</span></td>
      <td> Effective molal aqueous ionic strength</td>
      <td valign="top"><i>m</i><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">IC<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> <b>pH</b></span></td>
      <td> pH of aqueous solution (-log10
molal)</td>
      <td valign="top"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">pH<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> pe</span></td>
      <td> pe (redox) of aqueous solution (-log10
molal)</td>
      <td valign="top"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">pe<br>
      </td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> <b>Eh</b></span></td>
      <td> Eh (redox) of aqueous solution, <br>
      </td>
      <td valign="top">V<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> -</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace; text-align: center;"> +</td>
      <td style="font-family: monospace;">Eh<br>
      </td>
    </tr>
  </tbody>
</table>
<p>


Symbols in
parentheses (+) indicate data items that are automatically re-scaled
when
loaded from <tt>DATABR</tt> instance into <tt>MULTI </tt>structure,
or scaled back&nbsp; when extracted from
<tt>MULTI</tt> to <tt>DATABR</tt> instance. Only extensive
properties are re-scaled. </p>





<br>
<p>


2. Chemical
data arrays for the reactive sub-system (all double* C++ type). Values
of<span style="font-family: Helvetica,Arial,sans-serif;"> </span><span style="font-family: monospace;">nICb,nDCb,nPHb</span><span style="font-family: Helvetica,Arial,sans-serif;"> </span>and<span style="font-family: Helvetica,Arial,sans-serif;"> </span><span style="font-family: monospace;">nPSb</span><span style="font-family: Helvetica,Arial,sans-serif;"> </span>can be found
in the <tt>DATACH</tt> instance (or DCH file). Access to all arrays in
<tt>DATABR</tt> instance
requires the usage of <tt>DATACH</tt> <a href="#INDEX_MAPPING">index
mapping</a>
lists&nbsp;<span style="font-family: Helvetica,Arial,sans-serif;"> </span><span style="font-family: monospace;">xIC,xDC</span><span style="font-family: Helvetica,Arial,sans-serif;"> </span>and<span style="font-family: Helvetica,Arial,sans-serif;"> </span><span style="font-family: monospace;">xPH</span><span style="font-family: Helvetica,Arial,sans-serif;">. </span></p>





<span style="font-family: monospace;"></span>
<table style="width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td align="center">ID</td>
      <td align="center"> Dimensions</td>
      <td> Comment</td>
      <td align="center" valign="top">Units<br>
      </td>
      <td style="vertical-align: middle;">Default<br>
      </td>
      <td> MT-DB</td>
      <td> DB-GEM</td>
      <td> GEM-DB</td>
      <td>DB-MT</td>
      <td align="center"> Label in
DBR file</td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;" align="center"> bIC</td>
      <td style="font-family: monospace;" align="center">[nICb]</td>
      <td>Bulk amounts of
independent components<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="text-align: center;"><small>(+)</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="font-family: monospace;" align="center">bIC<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> rMB</td>
      <td style="font-family: monospace;" align="center"> [nICb]</td>
      <td> Mass balance residuals from GEMIPM<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small>(+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">rMB<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;" align="center"> uIC</td>
      <td style="font-family: monospace;" align="center"> [nICb]</td>
      <td> IC chemical potentials
(dimensionless)</td>
      <td align="center" valign="top"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="text-align: center;"><small> +<span style="font-family: monospace;"></span></small></td>
      <td style="font-family: monospace;" align="center">uIC<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;" align="center"> xDC</td>
      <td style="font-family: monospace;" align="center"> [nDCb]</td>
      <td> DC amounts <i>n</i><sup>(</sup><sup><i>x</i></sup><sup>)</sup>
in equilibrium state<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="text-align: center;"><small> {+}</small></td>
      <td style="text-align: center;"><small> {(+)}</small></td>
      <td style="text-align: center;"><small> (+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">xDC<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> gam</td>
      <td style="font-family: monospace;" align="center"> [nDCb]</td>
      <td>DC activity coefficients (dimensionless)<br>
      </td>
      <td align="center" valign="top"><br>
      </td>
      <td style="vertical-align: top;">1<br>
      </td>
      <td style="text-align: center;"><small>{+}</small></td>
      <td style="text-align: center;"><small> {+}</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">gam<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> dul</td>
      <td style="font-family: monospace;" align="center"> [nDCb]</td>
      <td>Upper metastability restrictions on xDC<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;">1e6<br>
      </td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="text-align: center;"><small>(+)</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="font-family: monospace;" align="center">dul<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> dll</td>
      <td style="font-family: monospace;" align="center"> [nDCb]</td>
      <td>Lower metastability restrictions on xDC<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="text-align: center;"><small>+</small></td>
      <td style="text-align: center;"><small> (+)</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="font-family: monospace;" align="center">dll<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> aPH</td>
      <td style="font-family: monospace;" align="center"> [nPHb]</td>
      <td> Specific surface areas of phases<br>
      </td>
      <td align="center" valign="top">m<sup>2</sup>/kg<br>
      </td>
      <td style="vertical-align: top;">0<br>
      </td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="font-family: monospace;" align="center">aPH<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;" align="center"> xPH</td>
      <td style="font-family: monospace;" align="center"> [nPHb]</td>
      <td> Total amounts of phases<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> (+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">xPH<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> <b>vPS</b></td>
      <td style="font-family: monospace;" align="center"> [nPSb]</td>
      <td>Volumes of phases-solutions<br>
      </td>
      <td align="center" valign="top">m<sup>3</sup><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small>(+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">vPS<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> mPS</td>
      <td style="font-family: monospace;" align="center"> [nPSb]</td>
      <td> Masses of phases-solutions<br>
      </td>
      <td align="center" valign="top">kg<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> (+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">mPS<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace; font-weight: bold;" align="center"> bPS</td>
      <td style="font-family: monospace;" align="center"> [nPSb][nICb]</td>
      <td>Bulk compositions of phases-solutions<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> (+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">bPS<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;" align="center"> xPA</td>
      <td style="font-family: monospace;" align="center"> [nPSb]</td>
      <td>Amounts of solvent/sorbent in phases-solutions<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="text-align: center;"><small>-</small></td>
      <td style="text-align: center;"><small> -</small></td>
      <td style="text-align: center;"><small> (+)</small></td>
      <td style="text-align: center;"><small> +</small></td>
      <td style="font-family: monospace;" align="center">xPA<br>
      </td>
    </tr>
    <tr>
      <td align="center" valign="top"><tt>bSP</tt><tt><br>
      </tt></td>
      <td align="center" valign="top"><tt>[nICb]</tt><tt><br>
      </tt></td>
      <td valign="top">Bulk composition of the equilibrium solid part
of the system<br>
      </td>
      <td align="center" valign="top">mol<br>
      </td>
      <td valign="top"><br>
      </td>
      <td align="center" valign="top"><tt>-</tt><tt><br>
      </tt></td>
      <td align="center" valign="top"><tt>-</tt><tt><br>
      </tt></td>
      <td align="center" valign="top"><tt>(+)</tt><tt><br>
      </tt></td>
      <td align="center" valign="top"><tt>+</tt><tt><br>
      </tt></td>
      <td align="center" valign="top"><tt>bSP</tt><tt><br>
      </tt></td>
    </tr>
  </tbody>
</table>


<p><span style="font-family: monospace;"></span></p>
<p>


Symbols in
parentheses (+) indicate data items that are automatically re-scaled
when
loaded from <tt>DATABR</tt> instance into <tt>MULTI </tt>structure,
or scaled back&nbsp; when extracted from
<tt>MULTI</tt> to <tt>DATABR</tt> instance. Only extensive
properties are re-scaled.&nbsp; Symbols in
braces {} indicate optional use for calculation of equilibrium in SIA
(smart initial approximation) mode of GEM IPM-3 algorithm. <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>

<span style="font-family: Helvetica,Arial,sans-serif;"></span><br>
<span style="font-family: Helvetica,Arial,sans-serif;">
</span>

<p>

3. FMT node
properties, all scalar double values, can be used for storing mass
transport parameters for nodes mainly at <tt>TNodeArray</tt><tt>TNode</tt> level. This information is normally not exchanged in the single-call
RMT-GEM coupling at the
implementation
level. </p>




<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td>ID</td>
      <td> Comment</td>
      <td valign="top">Units<br>
      </td>
      <td> Default</td>
      <td> Label in
DBR file</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> <b>Tm</b></td>
      <td> Actual total simulation time<br>
      </td>
      <td valign="top">s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> Tm</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> <b>dt</b></td>
      <td> Actual time step<br>
      </td>
      <td valign="top">s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> dt</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> Dif</td>
      <td> General diffusivity of disolved matter in the node</td>
      <td valign="top"><br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> Dif</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> Vt</td>
      <td> Total volume of the node
(voxel)<br>
      </td>
      <td valign="top">m<sup>3</sup><br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> Vt</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> vp</td>
      <td> Advection velocity (in
pores) in this node<br>
      </td>
      <td valign="top">m/s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> vp</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> eps</td>
      <td> Effective (actual) porosity normalized to 1</td>
      <td valign="top"><br>
      </td>
      <td> 1</td>
      <td style="font-family: monospace;"> eps</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> Km</td>
      <td> Actual permeability<br>
      </td>
      <td valign="top">m<sup>2</sup><br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> Km </td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> Kf</td>
      <td> Actual Darcy's constant<br>
      </td>
      <td valign="top">m<sup>2</sup>/s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> Kf</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> S</td>
      <td> Specific storage
coefficient, dimensionless (re-scaling factor for the system
mass)<br>
      </td>
      <td valign="top"><br>
      </td>
      <td> 1</td>
      <td style="font-family: monospace;"> S</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> Tr</td>
      <td> Transmissivity in the node<br>
      </td>
      <td valign="top">m<sup>2</sup>/s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> Tr</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> h</td>
      <td> Actual hydraulic head
(hydraulic potential)<br>
      </td>
      <td valign="top">m<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> h</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> rho</td>
      <td> Actual carrier density for density-driven
flow<br>
      </td>
      <td valign="top">kg/cm<sup>3</sup><br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> rho</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> al</td>
      <td> Specific longitudinal
dispersivity of porous media<br>
      </td>
      <td valign="top">m<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> al</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> at</td>
      <td> Specific transversal
dispersivity of porous media<br>
      </td>
      <td valign="top">m<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> at</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> av</td>
      <td> Specific vertical
dispersivity of porous media<br>
      </td>
      <td valign="top">m<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> av</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> hDl</td>
      <td>Hydraulic longitudinal dispersivity<br>
      </td>
      <td valign="top">m<sup>2</sup>/s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> hDl</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> hDt</td>
      <td> Hydraulic transversal dispersivity<br>
      </td>
      <td valign="top">m<sup>2</sup>/s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> hDt</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> hDv</td>
      <td> Hydraulic vertical dispersivity<br>
      </td>
      <td valign="top">m<sup>2</sup>/s<br>
      </td>
      <td> 0</td>
      <td style="font-family: monospace;"> hDv</td>
    </tr>
    <tr>
      <td style="font-family: monospace;"> nto</td>
      <td> Tortuosity factor, dimensionless<br>
      </td>
      <td valign="top"><br>
      </td>
      <td> 1</td>
      <td style="font-family: monospace;"> nto</td>
    </tr>
  </tbody>
</table>


<p> </p>
<p>


The
scaling factor S may be used for scaling the input/output extensive
variables of GEM IPM for keeping the size of reactive sub-system in GEM
runs reasonable, regardless of the node size. Especially
in&nbsp; finite-element methods, this can be necessary.&nbsp;<span style="font-family: monospace;"></span>

</p>

<p><b>Attention:</b> The above data fields in Table 3 except <tt>Tm</tt>
and <tt>dT</tt> can only be used in the <tt>DATABR</tt> structure
definition (and read from the DBR file) by compiling GEMS3K with a
global compiler key directive <tt>-DNODEARRAYLEVEL</tt>. This key is
required for any TNodeArray - level coupled code.<span style="font-family: monospace;"></span></p>


<span style="font-family: monospace;">
</span><span style="font-family: monospace;"></span> <span style="font-family: monospace;"></span><br>
<p>

4. GEM IPM-3
and RMT operation control flags and return codes (all scalar short
integer values)</p>




<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td style="font-family: Helvetica,Arial,sans-serif;">ID</td>
      <td style="font-family: Helvetica,Arial,sans-serif;"> Comment</td>
      <td style="font-family: Helvetica,Arial,sans-serif;"> Default</td>
      <td style="font-family: Helvetica,Arial,sans-serif;"> Label in
DBR file</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> NodeHandle</span></td>
      <td> Node identification handle</td>
      <td> 0</td>
      <td style="font-family: monospace;"> NodeHandle</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> NodeTypeHY</span></td>
      <td> Node type (hydraulic), see typedef
NODETYPE</td>
      <td> 0</td>
      <td style="font-family: monospace;"> NodeTypeHY</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> NodeTypeMT</span></td>
      <td> Node type (mass transport), see
typedef NODETYPE</td>
      <td> 0</td>
      <td style="font-family: monospace;"> NodeTypeMT</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> NodeStatusFMT</span></td>
      <td> Node status code FMT, see typedef NODECODEFMT</td>
      <td> 0</td>
      <td style="font-family: monospace;"> NodeStatusFMT</td>
    </tr>
    <tr>
      <td style="font-weight: bold;"><span style="font-family: monospace;"> NodeStatusCH</span></td>
      <td> Node status code CH, see typedef NODECODECH</td>
      <td> 1</td>
      <td style="font-family: monospace;"> NodeStatusCH</td>
    </tr>
    <tr>
      <td><span style="font-family: monospace;"> IterDone</span></td>
      <td> Total number of iterations
performed in the last GEM IPM-3 run for this node</td>
      <td> 0</td>
      <td style="font-family: monospace;"> IterDone</td>
    </tr>
  </tbody>
</table>


<p><span style="font-family: monospace;"></span></p>


<span style="font-family: Helvetica,Arial,sans-serif;"> </span>
<p>The <tt>IterDone</tt>
field can be used
after a GEM calculation for diagnostic purposes (e.g. to keep track of
GEM IPM-3 performance). The <tt>TNode</tt> class also provides several
function
calls that return the elapsed and pure GEM calculation time. </p>




<p>
The first
four flags are only important for the RMT part implemented at
TNodeArray level. </p>


<p>


For
calling GEM IPM-3
calculations, the correct handling of the <tt>NodeStatusCH</tt>&nbsp;flag
is of
utmost
importance. This flag sets at input the GEM initial approximation mode,
and will
be reset after GEM calculation to GEM IPM-3 return code. Hence, the
mass-transport
part must reset this flag every time when the GEM calculation is to be
done,
and check the return value immediately after getting the control back
from GEMS3K. Most important situations (at simple TNode level of
coupling):</p>






<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <p><span style="font-weight: bold;">AIA
(simplex) </span>initial approximation mode of GEM calculations <br></p>
      <p>
      
      (slow
but more
accurate and reproducible results)
      </p>
</td>
      <td style="vertical-align: top;">
      <p>
      Before calling GEM:
set NodeStatusCH to 1 (NEED_GEM_AIA). 
      </p>
      <p>
After GEM
calculation: check that NodeStatusCH contains 2 (OK_GEM_AIA). If yes
then copy
GEM results to MT data structures and proceed with the next node. If
no, but NodeStatusCH contains 3 (BAD_GEM_AIA) then decide on
further actions (e.g. check whether the current bulk composition in the
reactive sub-system is well balanced). 
      </p>
      <p>
If NodeStatusCH contains 4 (ERR_GEM_AIA) or 9 (T_ERROR_GEM),
generate a
diagnostic message and break the coupled modeling calculations. 
      </p>
      <p>
Code 9
(terminal error) usually reflects the dynamic memory corruption in GEM
IPM-2 kernel.
      </p>
</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">
      <p><span style="font-weight: bold;">SIA (smart)</span>
initial approximation mode of GEM calculations <br></p>
      
      <p>(fast but results may be
less accurate and, in general, not exactly reproducible)</p>
      </td>
      <td style="vertical-align: top;">
      <p>
      Before calling GEM:
set NodeStatusCH to 5 (NEED_GEM_SIA). 
      </p>
      <p>
After GEM
calculation: check that NodeStatusCH contains 6 (OK_GEM_SIA) or 2
(OK_GEM_AIA).
If yes then copy GEM results to MT data structures and proceed with the
next node. 
      </p>
      <p>
Code 2 in this situation means that the GEM IPM algorithm
had found the node chemical speciation inappropriate as initial
approximation and has switched to the automatic (simplex) initial
approximation. Accordingly, error codes 3 or 4 mean the same as above
for the AIA start. 
      </p>
      <p>
Seldomly, NodeStatusCH may contain 7 (BAD_GEM_SIA) or 8
(ERR_GEM_SIA); if so, the MT part
may try re-starting GEM calculation for this node in the AIA mode. 
      </p>
</td>
    </tr>
  </tbody>
</table>


<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"></span><br>
<p>


In the
AIA (automatic initial approximation) mode, GEM
calculations are 100% reproducible but may rather slow (20 to 1000 IPM
iterations depending on the chemical system definition and
composition) because the simplex initial approximation is in general
not close to Gibbs energy minimum when phases solutions (especially
non-ideal) are present in the system. 

</p>
<p><span style="font-family: Helvetica,Arial,sans-serif;"></span></p>
<p>


The alternative SIA (smart initial
approximation) mode uses the
currently available contents of the speciation (<tt>xDC</tt>) and
activity
coefficients (<tt>gam</tt>) vectors (perhaps
modified
through the <tt>DATABR</tt> interface after the mass transport step)
as the
initial approximation. If the xDC
vector for the current node does not violate the mass balance relative
to the current bulk
composition vector bIC, and neither the
phase assemblage nor the redox
state are going to change, then GEM is expected to do 0 to 10
iterations, i.e. 10-20 times faster than in the AIA mode. This
acceleration can be relevant for large
2-D or 3-D coupled RMT models. However, the SIA mode result is by
definition not exactly reproducible. Even repeated SIA mode
calculations for the same system always yield slightly different
amounts of dependent components because the previously computed
speciation taken as initial approximation is slightly different.
However, it is unlikely that this may lead to diverging coupled
modelling results because any GEM-calculated speciation must converge
to the Gibbs energy minimum. Nevertheless, the behavior of SIA mode GEM
calculation
relative to AIA in coupled models still needs more testing and
verification.<span style="font-family: Helvetica,Arial,sans-serif;"></span>

</p>
<p>



The SIA
GEM calculation mode may be preferable over the AIA mode when the
mass transport part moves aqueous species. In this case, any changed
chemical speciation in the node is guaranteed to remain mass-balanced
because the corrections to the bulk composition vector bIC are
calculated from the corrections to xDC
vector. The latter then is a good initial approximation at least in the
sense of mass balance, so the GEM MBR()
procedure is not expected to do any extra iterations. <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>


<p>



In meaningful
RMT problems, the phase association changes or redox
transitions occur
along some distinct reaction fronts or barriers that are represented by
only a small fraction of the nodes. In such a node, it may happen that
the
current speciation turns to be a bad GEM initial approximation. The GEM
IPM kernel has several built-in criteria to check if this happens
indeed; if so, then the program "smartly" switches to simplex (AIA)
initial approximation and obtains correct new phase assemblage and
speciation just at cost of performing more iterations. However,&nbsp;
for the vast majority of nodes that lie not in the vicinity of rock
heterogeneities or reaction fronts, slight changes of speciation and
composition upon the transport time iteration would not result in any
phase or redox transitions. In this case, the SIA approximation appears
safe
enough and GEM IPM is expected to converge in 1 to 10 iterations.</p>
<br>

<span style="font-family: Helvetica,Arial,sans-serif;">
</span>


<hr size="2" width="100%">
<h3><a name="TAG_TNODE"></a> 3.3. TNode class for
simple coupling of GEMS3K to transport
codes</h3>
<p>


The
TNode C++
class (defined in node.h
file,
implemented in node.cpp
and node_format.cpp
files) provides
a selection of methods (function calls) for an easy coupling of GEMS3K
with an already existing mass transport code that keeps
chemical information
in its own data arrays. The use of TNode class functionality is
described in detail
in the <a href="gems3k-useref.html">User's Reference</a> file.
Overview of two
programming examples is provided in the <a href="gems3k-nodelev.html">HowTo
file</a>. The format of GEMS3K input IPM, DCH and DBR
files is
described in detail in a <a href="gems3k-iofiles.html">companion
document</a>.

</p>

 <br>


<hr size="2" width="100%">
<h3><a name="TAG_TNODEARRAY"></a>3.4. TNodeArray class for the advanced
coupled code development<br>
</h3>


<p><span style="font-size: 12pt;">The </span><tt><span style=""><span style="font-size: 10pt;">TNodeArray</span></span></tt><span style="font-size: 12pt;"> class is an extension of the </span><tt><span style=""><span style="font-size: 10pt;">TNode</span></span></tt><span style="font-size: 12pt;"> class to facilitate writing of new coupled R<st1:stockticker w:st="on">MT</st1:stockticker> or sensitivity analysis codes that use
the <st1:stockticker w:st="on">GEM</st1:stockticker>S3K chemical
solver. In this class, a
two-layer array of </span><tt><span style=""><span style="font-size: 10pt;">DATABR</span></span></tt><span style="font-size: 12pt;"> structures is created in memory to
efficiently keep
information about all nodes at current and previous time steps. Access
to a
given node is possible through the node handle (index). In the node
array elements,
only data that may change from node to node or from time to time are
stored. C++
access methods are provided for both <st1:stockticker w:st="on">GEM</st1:stockticker>
and <st1:stockticker w:st="on">RMT</st1:stockticker> parts for easy
direct
access to any data element in the node array. Chemical information that
does
not change during the coupled modeling session is kept in a single
instance of </span><tt><span style=""><span style="font-size: 10pt;">DATACH</span></span></tt><span style="font-size: 12pt;"> structure, which is also needed for
accessing nodes
and is visible from both <st1:stockticker w:st="on">GEM</st1:stockticker>
and <st1:stockticker w:st="on">RMT</st1:stockticker> parts.</span> 

</p>
<p>
The basic
idea of TNodeArray is to maintain two arrays of pointers to <tt>DATABR</tt>
structures: one array <tt>C0</tt> for the previous (<tt>t0</tt>) and
one <tt>C1</tt> for the
current time (<tt>t1</tt>) moment. The <tt>DATABR</tt>
structures keeping information for each node are dynamically allocated.
Using <tt>TNode</tt> class access methods, the mass transport part can
read any
data for nodes from the <tt>C0</tt> layer of the
node array and put modified speciation, composition, or temperature
for each node in the respective structure linked to the <tt>C1</tt>
layer of the
node array. The GEM calculations (chemical equilibration) are always
performed over the nodes in the <tt>C1</tt> node array layer. Then, in
the
(optional) back-coupling algorithm, the decision about the acceptance
of the time step dt is made. The time
step can always be made smaller and the transport loop can be repeated,
if necessary, followed by the chemical&nbsp; equilibration loop. Only
when the time step is accepted, the data for each node are copied from <tt>C1</tt>
layer into
the respective <tt>DATABR</tt> structures in the <tt>C0</tt> node
array layer. 

</p>

<span style="font-family: Helvetica,Arial,sans-serif;"> </span>
<p>



The <tt>TNodeArray</tt> class contains
integrated calls that allow
all equilibria in nodes to be recomputed wherever needed, and methods
that can
dump contents of all nodes into disk file(s) to interrupt calculations,
then
restore and continue them later on. The advantage of <tt>TNodeArray</tt>
is that no
chemical information should be stored in the RMT part, thus making it
potentially simpler, more
efficient and much more transparent. However, a detailed consideration
of <tt>TNodeArray</tt> operation is in
the scope of another document.

</p>
<p>
The methods of
data access specific to <tt>TNodeArray</tt> class are defined in <tt>nodearray.h</tt>,
implemented in <tt>nodearray.cpp</tt> files, and&nbsp;
will be described in a separate <a href="gems3k-nodearray.html">document
(in
preparation)</a>. The example of using the <tt>TNodeArray</tt> class
functionality is provided in the <tt>main.cpp</tt> file in "<tt>nodearray-gem\</tt>"
folder. This example is a prototype of a finite-difference or
random-walk
advection-diffusion mass transport model (supplied by&nbsp; F. Enzmann).</p>


<br>


<hr style="width: 100%; height: 2px;">
<h2><a name="TAG_PROGRAMMING"></a>4. Programming and technical issues</h2>
<p>


The program
source code is compatible with ANSI
C++ and can be compiled on many computer platforms (Windows, Linux, HPC
Merlin, Cray XT, etc.) using several optimizing
compilers (GNU C++, PGI C++, Intel
C++, Microsoft C++, &#8230; ). The make scripts for some of this platforms
are located in "<tt>/GEMS3K/platform</tt>" subfolders. </p>




<h3><a name="TAG_SVN"></a>4.1.
Subversion repository of GEMS3K source code<br>
</h3>
<p>


The GEMS3K
program
source code comprises a sub-set of C++
source code files used in the <a style="font-family: Helvetica,Arial,sans-serif;" href="http://gems.web.psi.ch/">GEM-Selektor package</a>.&nbsp;&nbsp;
The list of source
code files common to both
GEM-Selektor
and GEMS3K programs is provided <a href="#TAG_SOURCE_FILELIST">above
in this file</a>. <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>
<p><span style="font-family: Helvetica,Arial,sans-serif;">
</span>


The GEMS3K
source code tree resides in the Subversion repository at PSI on the
server savannah01.psi.ch. This server can only be accessed through the
SSH
protocol (in Subversion client checkout, the URL should begin with<span style="font-family: Helvetica,Arial,sans-serif;"> </span>svn+ssh://).
For the user
account and details about accessing the repository, please ask the <a href="http://gems.web.psi.ch">GEMS Development Team</a>.
A GEMS3K Subversion trunk repository mirror on assembla.com is under
construction. Alternatively, you can download a zipped working copy
of the source code from <a href="http://gems.web.psi.ch/GEMS3K/">GEMS3K
web page</a>, then simply unpack it into your home or
development directory. <span style="font-family: Helvetica,Arial,sans-serif;"></span></p>

<span style="font-family: Helvetica,Arial,sans-serif;">
</span>
<p>


On your computer, the source
code should be located in the<span style="font-family: Helvetica,Arial,sans-serif;"> </span><big><span style="font-family: monospace;">"<small>\standalone</small></span><span style="font-family: monospace;"><small>\GEMS3K\</small>" </span></big>subfolder,
the
node-gem example - in the "<big><span style="font-family: monospace;"><small>\standalone</small></span><small><span style="font-family: monospace;">\node-gem</span></small></big><span style="font-family: Helvetica,Arial,sans-serif;"><small>\</small></span>"
subfolder.<span style="font-family: Helvetica,Arial,sans-serif;"></span></p>
<p><span style="font-family: Helvetica,Arial,sans-serif;">
</span>
This
documentation file (with others) resides in the <big><span style="font-family: monospace;">"<small>\standalone</small></span><span style="font-family: monospace;"><small>\GEMS3K\doc\html\</small>"</span></big>
folder. Details on downloading and installation are also given in the <a href="http://gems.web.psi.ch/GEMS3K/techinfo.html">Techinfo page</a>
on GEMS3K web page.


</p>

<h3><a name="TAG_FMT_CPP"></a>4.2. Mass transport part in C++<br>
</h3>
<p>


If you mass transport part is written in C++, you can add&nbsp; the
C++&nbsp; source code to you project- or Makefile and
compile all files at the same time. Important: you must use compiler
directives "<tt>-DIPMGEMPLUGIN</tt>", If coupled at TNode level, do not
use&nbsp; "<tt>-DNODEARRAYLEVEL"</tt>. You can also compile a dynamic
or static GEMS3K library and link it to your compiled RMT code. Details
on compiling and linking are given in the <a href="http://gems.web.psi.ch/GEMS3K/techinfo.html">Techinfo page</a>
on GEMS3K web page.</p>






<h3><a name="TAG_FMT_FORTRAN"></a>4.3. Mass transport part in Fortran <br>
</h3>
<p>


If you mass transport part is written in Fortran, you can
add&nbsp; this sub-set of C++&nbsp; source code to you project you must
use compiler directives "<tt>-DIPMGEMPLUGIN</tt>", If coupled at TNode
level, do not use&nbsp; "<tt>-DNODEARRAYLEVEL".</tt> Alternatively,
make a GEMS3K static or dynamic library and link it
to your compiled fortran program. Details on compiling and linking
GEMS3K library are given in the <a href="http://gems.web.psi.ch/GEMS3K/techinfo.html">Techinfo page</a>
on GEMS3K web page.</p>







<h3><a name="TAG_BUILD"></a>4.4. Building GEMS3K executables<br>
</h3>
<p>


The easiest way
to build GEMS3K is to use the standard <tt>make</tt> command
(available in
most platforms) together with GNU C++ compiler suite v. 4.2 or higher.
In Windows XP/7 we recommend to download and use the MinGW port
of GNU tools (<a href="http://www.mingw.org">http://www.mingw.org</a>).
In Linux or&nbsp; Mac OS X, the GNU tools are provided by default (in
Linux, take care that the main Development packages are
installed). </p>
<p>



There are two
alternative make files in GEMS3K source code tree, provided each pair
for different arcitectures in the
./platforms subdirectories. 

</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">


  <tbody>
    <tr>
      <td style="font-family: monospace;">Makefile</td>
      <td style="vertical-align: top;">make script for building test
example with file I/O as a standalone executable file <br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">Makefile.lib</td>
      <td style="vertical-align: top;">make script for creating a
static library for subsequent linking with other parts of the coupled
FMT-GEM code<br>
      </td>
    </tr>
  </tbody>
</table>


<big><span style="font-family: monospace;"></span></big><br>
<p><tt>Makefile</tt> script file is used
for building
a static executable file gemcalc(.exe) for the test
example.

</p>

<tt>Makefile.lib</tt> script file can be
used for
building a static library&nbsp; libgems3k.a (or libgems3k.so) which can
be linked
to the mass-transport&nbsp; part to produce a coupled code later on. <span style="font-family: Helvetica,Arial,sans-serif;"></span><br>


<span style="font-family: Helvetica,Arial,sans-serif;">
</span>
<p>
A recommended way of building GEMS3K examples is to use QtSDK and
qmake, as described in in the <a href="http://gems.web.psi.ch/GEMS3K/techinfo.html">Techinfo web page</a>.</p>



<span style="font-family: Helvetica,Arial,sans-serif;">
</span>
<h4><a name="TAG_GNU"></a>GNU C++ (gcc - gfortran) on Linux, Mac OS X,
and MinGW (Windows)</h4>
<p>


GEMS3K is
developed using GNU C++ (version 3.5 or higher) and related tools under
Linux, MacOS X and Windows XP/7 (MinGW). The version of CNU
C++ (4.4.x) is recommended. Before trying to compile GEMS3K
for the first time, make sure that you have the GNU C++ compiler,
binutils, libraries, debugger and other related tools installed and
accessible through system environment variables. 

</p>
<p>
The make scripts
are located in <tt>"~/standalone/GEMS3K/platform/win32MinGW"</tt>
for Windows, <tt>"~/standalone/GEMS3K/platform/Linux-GNU"</tt>
for Linux, and <tt>"~/standalone/GEMS3K/platform/MacOSX"</tt>
for Mac OS X.
Copy the corresponding Makefile to the working
directory, e.g. <tt>"~/standalone/GEMS3K/gemcalc/"</tt>.

</p>
<p>
From this
directory, different build modes can be invoked by typing a console
command 

</p>

<tt>"make &lt;target&gt;" </tt>&nbsp;&nbsp; (or mingw32-make
&lt;target&gt; for
MinGW)

<br>
<p>
The parameter
&lt;target&gt; may be one of the following: </p>



&nbsp; <tt>all&nbsp;</tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
create object files and the executable file<br>


&nbsp; <tt>clean&nbsp;</tt>&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; remove all object files<br>


&nbsp; <tt>distclean</tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clean
and remove executable file
<br>
<p>
For instance, to
create the executable file, type

</p>

 <tt>&nbsp;make&nbsp;&nbsp;</tt>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ( or &nbsp; &nbsp;&nbsp; make all
)

<br>
<p>
To rebuild the
executable file after performing optimized compile, edit Makefile
(change there compiler key <tt>-g</tt> to <tt>-O2</tt> ) and then
type </p>



<tt>make clean
</tt><tt><br>
</tt><tt>make</tt>
<br>
<p>
A recommended way of building GEMS3K examples is to use QtSDK and
<span style="font-family: monospace;">qmake</span>, as described in in the <a href="http://gems.web.psi.ch/GEMS3K/techinfo.html">Techinfo web page</a>.</p>



<span style="font-family: Helvetica,Arial,sans-serif;">
<br>
</span>
<hr style="width: 100%; height: 2px;"><span style="font-family: Helvetica,Arial,sans-serif;"></span>
<h2><a name="TAG_REFERENCES"></a>5. References</h2>


<a name="Ref_Bethke-1996"></a> Bethke, C. M. (2008): Geochemical and
Biogeochemical Reaction Modeling. Cambridge University Press, New
York&nbsp; (<a href="http://hercules.geology.uiuc.edu/%7Ebethke/hydro_gwb.htm">http://hercules.geology.uiuc.edu/~bethke/hydro_gwb.htm</a>)<br>


<br>


<a name="Ref-Borisov-1992"></a>Borisov, M.V., Shvarov, Y.V. (1992):
Thermodynamics of geochemical processes. Moscow State University
Publishers, Moscow, in Russian<br>


<br>


<a name="Ref_Bruno_ea_2007"></a> Bruno J.,
Bosbach D., Kulik D., Navrotsky A. (2007): <i>Chemical
thermodynamics of solid solutions of interest in radioactive waste
management: A state-of-the art report</i>, Eds.
F.J.Mompean, M.Illemassene, J.Perrone, Chemical Thermodynamics Series
Vol. <span style="font-weight: bold;">10</span>, Paris, OECD, 292 p.
(<a href="http://www.nea.fr/html/dbtdb/info/publications/welcome.html">http://www.nea.fr/html/dbtdb/info/publications/welcome.html</a>)<br>


<br>


<a name="Ref_TM-44-02-06"></a> Chudnenko, K.V., Karpov, I.K., Kulik,
D.A. (2002): A high-precision IPM-2 non-linear minimization mod-ule of
GEM-Selektor v.2-PSI program code for geochemical thermodynamic
modeling. Technical Report TM-44-02-06, Paul Scherrer Institut,
Villigen.<br>


<br>


<a name="Ref-Chudnenko-2010"></a>Chudnenko, K.V. (2010): Thermodynamic
modeling in geochemistry: the theory, the algortithms, the soft-ware,
the applications. Academic Publishing House GEO, Novosibirsk (2010), in
Russian.<br>


<br>


<a name="Ref-Hummel-2002"></a>Hummel, W., Berner., U., Curti, E.,
Pearson, F.J., Thoenen, T.&nbsp; (2002): Nagra/PSI chemical
thermodynamic data base 01/01. Pp. 589. Universal-Publishers<br>


<br>


<a name="Ref_Karpov-ea-2001"></a> Karpov I.K.,
Chudnenko
K.V., Kulik D.A., Avchenko O.V. and Bychinski V.A. (2001). Minimization
of Gibbs free energy in geochemical systems by convex programming.
Geochemistry International <span style="font-weight: bold;">39</span>(11),
1108-1119. <br>


<br>


<a name="Ref_Karpov-ea-1997"></a> Karpov I.K.,
Chudnenko
K.V.
and Kulik D.A. (1997): Modeling chemical mass-transfer in geochemical
processes: Thermodynamic relations, conditions of equilibria and
numerical algorithms.
American Journal of Science <span style="font-weight: bold;">297</span>,
767-806<br>


<br>


<a name="Ref_Kulik-ea-2004"></a> Kulik D.,
Berner U., Curti E.
(2004): Modelling chemical equilibrium partitioning with the GEMS-PSI
code. In: PSI Scientific Report 2003 / Volume <span style="font-weight: bold;">IV</span>, Nuclear Energy and
Safety (edited by B.Smith and B.Gschwend), Paul Scherrer Institute,
Villigen, Switzerland, March 2004, p.109-122 (ISSN 1423-7334) (<a href="http://gems.web.psi.ch/">http://gems.web.psi.ch/</a>)<br>


<br>


<a name="Ref_Kulik_ea-2012"></a> Kulik D.A., Wagner T., Dmytrieva S.V.,
Kosakowski G., Hingerl
F.F., Chudnenko K.V., Berner U. (2012): GEM-Selektor geochemical
modeling package: Numerical kernel GEMS3K for coupled simulation codes.
<span style="font-style: italic;">Computational Geosciences</span>
(in press), <a href="http://dx.doi.org/10.1007/s10596-012-9310-6" target="_blank">http://dx.doi.org/10.1007/s10596-012-9310-6</a>).<br>


<br>


<a name="Ref_Morel-Hering-1993"></a> Morel, F. M. M., Hering, J. G.
(1993): Principles and applications of aquatic chemistry. New York et
al., Wiley Interscience. <br>


<br>


<a name="Ref_Parkhurst-Appelo-1999"></a> Parkhurst, D.L., Appelo,
C.A.J. (1999): User's guide to PHREEQC (version 2) - A computer program
for speciation, batch-reaction, one-dimensional transport, and inverse
geochemical calculations. U.S.G.S. Water-Resources Investigations
Report 99-4259, Denver, Colorado (1999) (<a href="http://wwwbrr.cr.usgs.gov/projects/GWC_coupled/phreeqc/%29">http://wwwbrr.cr.usgs.gov/projects/GWC_coupled/phreeqc/)</a><br>


<br>


<a name="Ref_Reed-1982"></a> . Reed, M.H. (1982): Calculation of
multicomponent chemical equilibria and reaction processes in systems
involving minerals, gases and an aqueous phase. Geochimica et
Cosmochimica Acta 46, 513-528.<br>


<br>


<a name="Ref-Wagner-2012"></a>Wagner, T., Kulik, D.A., Hingerl, F.F.,
Dmytrieva, S.V. (2012): GEM-Selektor geochemical modeling package:
TSolMod C++ class library and data interface for multicomponent phase
models. Canadian Mineralogist (2012), in press.<br>


<br>


<a name="Ref_van-der-Lee-1998"></a> van der Lee J. (1998):
Thermodynamic and mathematical concepts of CHESS, Technical Report Nr.
LHM/RD/98/39, Ecole des Mines de Paris, Fontaineleau, France&nbsp; (<a href="http://chess.ensmp.fr/doc.html">http://chess.ensmp.fr/doc.html</a>).<br>


<br>


<a name="Ref-VanDerLee-2003"></a>Van der Lee, J., De Windt, L.,
Lagneau, V., Goblet, P. (2003): Module-oriented modeling of reactive
transport with HYTEC. Computers and Geosciences 29, 265-275.<br>


<br>


<a name="Ref_Van-Zeggeren-1970"></a> Van Zeggren, F., Storey, S. H.
(1970): The computation of chemical equilibria. Cambridge, Cambridge
University Press.<br>


<br>


<hr style="width: 100%; height: 2px;"><br>


Last edited: 15.10.2012 DK<br>


<br>


Copyright (c) 2012 <a href="http://gems.web.psi.ch/teamhist.html">GEMS Development Team</a><br>
<br>
&nbsp;

<br>
</body></html>